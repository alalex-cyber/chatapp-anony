<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>University Chat</title>
  <!-- Lucide Icons Library -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.244.0/lucide.min.js"></script> -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- CryptoJS for MD5 hashing (Gravatar) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!-- Initialize Lucide Icons -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM fully loaded, initializing chat');
      lucide.createIcons();
      
      // Make sure to update the user avatar right away
      setTimeout(() => {
        updateUserAvatar();
      }, 100);
    });
  </script>
  <style>
    /* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

:root {
/* Dark Mode Gradients with warmer tones */
--bg-gradient-dark: linear-gradient(to bottom right, #1E293B, #312e81, #4c1d95);
--bg-gradient-light: linear-gradient(to bottom right, #F8F9FA, #e0e7ff, #f5f3ff);

/* Base Colors */
--primary-dark: #1E293B;
--primary-light: #F8F9FA;

/* Blue Scale - Improved contrast */
--blue-950: #0F172A;
--blue-900: #1E293B;
--blue-800: #2563eb;
--blue-700: #3b82f6;
--blue-600: #4f46e5;
--blue-500: #6366f1;
--blue-400: #818cf8;
--blue-300: #a5b4fc;
--blue-200: #c7d2fe;
--blue-100: #dbeafe;
--blue-50: #f0f9ff;

/* Indigo Scale - Enhanced depth */
--indigo-900: #312e81;
--indigo-600: #5046e5;
--indigo-500: #6366f1;
--indigo-100: #e0e7ff;

/* Green Scale - More vibrant */
--green-700: #15803d;
--green-600: #16a34a;
--green-500: #22c55e;
--green-300: #86efac;

/* Red Scale - Improved visibility */
--red-600: #dc2626;
--red-500: #ef4444;
--red-400: #f87171;
--red-300: #fca5a5;

/* Yellow Scale - Better contrast */
--yellow-800: #854d0e;
--yellow-700: #a16207;
--yellow-600: #ca8a04;
--yellow-500: #eab308;
--yellow-400: #facc15;
--yellow-300: #fde047;

/* Border Colors */
--border-dark: rgba(37, 99, 235, 0.3);
--border-light: #e2e8f0;

/* Text Colors - Reduced harshness */
--white: #ffffff;
--text-dark: #E2E8F0;
--text-light: #1E293B;
--text-muted-dark: #a5b4fc;
--text-muted-light: #3b82f6;

/* Gray Scale */
--gray-900: #1a1a1a;
--gray-800: #333;
--gray-700: #444;
--gray-100: #f9f9f9;
}


body {
  width: 100%;
  height: 100vh;
  overflow: hidden;
  background: var(--bg-gradient-dark);
  color: var(--text-dark);
  font-weight: 400;
  line-height: 1.5;
  position: relative;
}

/* WhatsApp-style background pattern with tech/emoji icons */
body::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='600' viewBox='0 0 600 600' opacity='0.08'%3E%3Cpath d='M48 58c5.8-5.7 15.1-6.7 22-2 5.5 4 7.6 11.5 5.2 17.8-2.2 5.5-7.5 9.3-13.4 9.8-8.6.8-16.8-5.9-17.6-14.5-.5-4.3.7-8.5 3.8-11.1zm43 36c7.4-2.3 15.2 1.8 17.5 9.1 2.3 7.4-1.8 15.2-9.1 17.5-7.4 2.3-15.2-1.8-17.5-9.1-2.3-7.4 1.8-15.2 9.1-17.5zm-26.9 39.8-5 .2 2.2 4.6c1.2 2.5.2 5.5-2.3 6.7s-5.5.2-6.7-2.3l-2.2-4.6-4.5 2.4c-2.4 1.3-5.5.4-6.8-2s-.4-5.5 2-6.8l4.5-2.4-2.5-4.4c-1.4-2.4-.5-5.5 1.9-6.9s5.5-.5 6.9 1.9l2.5 4.4 5-.2c2.8-.1 5.1 2 5.2 4.8s-2 5.1-4.8 5.2zM32 170c3 5 9.5 6.6 14.5 3.6s6.6-9.5 3.6-14.5-9.5-6.6-14.5-3.6-6.6 9.5-3.6 14.5zm59 64c7.8-6.4 9-17.8 2.6-25.6s-17.8-9-25.6-2.6-9 17.8-2.6 25.6 17.8 9 25.6 2.6zm160-70c5.8 3 12.8.8 15.8-5s.8-12.8-5-15.8-12.8-.8-15.8 5-.8 12.8 5 15.8zm50 104c2-5.7 8.3-8.7 14-6.7 5.7 2 8.7 8.3 6.7 14-2 5.7-8.3 8.7-14 6.7-5.7-2-8.7-8.3-6.7-14zm-135 75c-8-8-8-20.9 0-28.9s20.9-8 28.9 0 8 20.9 0 28.9-20.9 8-28.9 0zm2-105c-6.1 3.3-13.8 1-17.1-5.1-3.3-6.1-1-13.8 5.1-17.1 6.1-3.3 13.8-1 17.1 5.1 3.3 6.1 1 13.8-5.1 17.1zm80-166c4.2-4.2 11.2-4.2 15.5 0 4.2 4.3 4.2 11.3 0 15.5-4.2 4.3-11.2 4.3-15.5 0-4.2-4.2-4.2-11.2 0-15.5zm10 315c-3.6 4.8-10.4 5.8-15.2 2.2s-5.8-10.4-2.2-15.2 10.4-5.8 15.2-2.2 5.8 10.4 2.2 15.2zm-91 83c7.8 1.6 12.8 9.3 11.2 17.1s-9.3 12.8-17.1 11.2-12.8-9.3-11.2-17.1 9.3-12.8 17.1-11.2zm188-49c3.6-7.8 12.8-11.2 20.6-7.6 7.8 3.6 11.2 12.8 7.6 20.6-3.6 7.8-12.8 11.2-20.6 7.6-7.8-3.6-11.2-12.8-7.6-20.6zm10-74.8 5 .8-.8-5c-.5-2.7 1.3-5.3 4-5.8s5.3 1.3 5.8 4l.8 5 4.7-1.8c2.6-1 5.5.3 6.5 2.9s-.3 5.5-2.9 6.5l-4.7 1.8 3.2 3.9c1.8 2.1 1.5 5.3-.6 7.1s-5.3 1.5-7.1-.6l-3.2-3.9-4.9 1.4c-2.7.8-5.6-.8-6.3-3.5-.8-2.7.8-5.6 3.5-6.3l4.9-1.4-.9-5c-.5-2.7 1.3-5.3 4-5.8s5.3 1.3 5.8 4l.9 5zM316 455c-5.3 0-9.6-4.3-9.6-9.6s4.3-9.6 9.6-9.6 9.6 4.3 9.6 9.6-4.3 9.6-9.6 9.6zm-43-21.2 3.9-3.2-4.9-1.4c-2.7-.8-4.3-3.6-3.5-6.3s3.6-4.3 6.3-3.5l4.9 1.4 1.4-4.9c.8-2.7 3.6-4.3 6.3-3.5s4.3 3.6 3.5 6.3l-1.4 4.9 4.7 1.8c2.6 1 3.9 3.9 2.9 6.5s-3.9 3.9-6.5 2.9l-4.7-1.8-.8 5c-.5 2.7-3.1 4.5-5.8 4s-4.5-3.1-4-5.8l.8-5-3.9 3.2c-2.1 1.8-5.3 1.5-7.1-.6s-1.5-5.3.6-7.1zm-90-34c-6.7-6.7-6.7-17.5 0-24.2 6.7-6.7 17.5-6.7 24.2 0s6.7 17.5 0 24.2-17.5 6.7-24.2 0zm240 42c-6.6 0-12-5.4-12-12s5.4-12 12-12 12 5.4 12 12-5.4 12-12 12zm112-200c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm-58-80c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5zm-30 60c-7.7 0-14-6.3-14-14s6.3-14 14-14 14 6.3 14 14-6.3 14-14 14zM194 42c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm-35 8c-7.7 0-14-6.3-14-14s6.3-14 14-14 14 6.3 14 14-6.3 14-14 14zm-40 432c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm310 48c5.5 0 10 4.5 10 10s-4.5 10-10 10-10-4.5-10-10 4.5-10 10-10zm-40-12c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm-74 8c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm-281-18c4.4 0 8 3.6 8 8s-3.6 8-8 8-8-3.6-8-8 3.6-8 8-8zm81-46c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm210-305c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm-260-89c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5zm375 53c5 0 9 4 9 9s-4 9-9 9-9-4-9-9 4-9 9-9zm85 305c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10zm-52-157c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm-82 262c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm-305 35c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm380-50c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zM135 135c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm190 50c5.5 0 10 4.5 10 10s-4.5 10-10 10-10-4.5-10-10 4.5-10 10-10zm63 58c1.7 0 3 1.3 3 3s-1.3 3-3 3-3-1.3-3-3 1.3-3 3-3zm-18-222c4.4 0 8 3.6 8 8s-3.6 8-8 8-8-3.6-8-8 3.6-8 8-8zm-275 80c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-45 285c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm360-15c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-330-330c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm275 430c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm80-330c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm-245 40c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm420 77c-2.7 0-5-2.3-5-5.1s2.3-5.1 5-5.1 5 2.3 5 5.1c0 2.9-2.3 5.1-5 5.1z' fill='%23333' /%3E%3C/svg%3E");
  background-repeat: repeat;
  opacity: 0.05;
  z-index: -2;
  pointer-events: none;
}

body.light-mode {
  background: var(--bg-gradient-light);
  color: var(--text-light);
}

/* Adjust light mode pattern to be darker */
body.light-mode::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='600' viewBox='0 0 600 600' opacity='0.1'%3E%3Cpath d='M48 58c5.8-5.7 15.1-6.7 22-2 5.5 4 7.6 11.5 5.2 17.8-2.2 5.5-7.5 9.3-13.4 9.8-8.6.8-16.8-5.9-17.6-14.5-.5-4.3.7-8.5 3.8-11.1zm43 36c7.4-2.3 15.2 1.8 17.5 9.1 2.3 7.4-1.8 15.2-9.1 17.5-7.4 2.3-15.2-1.8-17.5-9.1-2.3-7.4 1.8-15.2 9.1-17.5zm-26.9 39.8-5 .2 2.2 4.6c1.2 2.5.2 5.5-2.3 6.7s-5.5.2-6.7-2.3l-2.2-4.6-4.5 2.4c-2.4 1.3-5.5.4-6.8-2s-.4-5.5 2-6.8l4.5-2.4-2.5-4.4c-1.4-2.4-.5-5.5 1.9-6.9s5.5-.5 6.9 1.9l2.5 4.4 5-.2c2.8-.1 5.1 2 5.2 4.8s-2 5.1-4.8 5.2zM32 170c3 5 9.5 6.6 14.5 3.6s6.6-9.5 3.6-14.5-9.5-6.6-14.5-3.6-6.6 9.5-3.6 14.5zm59 64c7.8-6.4 9-17.8 2.6-25.6s-17.8-9-25.6-2.6-9 17.8-2.6 25.6 17.8 9 25.6 2.6zm160-70c5.8 3 12.8.8 15.8-5s.8-12.8-5-15.8-12.8-.8-15.8 5-.8 12.8 5 15.8zm50 104c2-5.7 8.3-8.7 14-6.7 5.7 2 8.7 8.3 6.7 14-2 5.7-8.3 8.7-14 6.7-5.7-2-8.7-8.3-6.7-14zm-135 75c-8-8-8-20.9 0-28.9s20.9-8 28.9 0 8 20.9 0 28.9-20.9 8-28.9 0zm2-105c-6.1 3.3-13.8 1-17.1-5.1-3.3-6.1-1-13.8 5.1-17.1 6.1-3.3 13.8-1 17.1 5.1 3.3 6.1 1 13.8-5.1 17.1zm80-166c4.2-4.2 11.2-4.2 15.5 0 4.2 4.3 4.2 11.3 0 15.5-4.2 4.3-11.2 4.3-15.5 0-4.2-4.2-4.2-11.2 0-15.5zm10 315c-3.6 4.8-10.4 5.8-15.2 2.2s-5.8-10.4-2.2-15.2 10.4-5.8 15.2-2.2 5.8 10.4 2.2 15.2zm-91 83c7.8 1.6 12.8 9.3 11.2 17.1s-9.3 12.8-17.1 11.2-12.8-9.3-11.2-17.1 9.3-12.8 17.1-11.2zm188-49c3.6-7.8 12.8-11.2 20.6-7.6 7.8 3.6 11.2 12.8 7.6 20.6-3.6 7.8-12.8 11.2-20.6 7.6-7.8-3.6-11.2-12.8-7.6-20.6zm10-74.8 5 .8-.8-5c-.5-2.7 1.3-5.3 4-5.8s5.3 1.3 5.8 4l.8 5 4.7-1.8c2.6-1 5.5.3 6.5 2.9s-.3 5.5-2.9 6.5l-4.7 1.8 3.2 3.9c1.8 2.1 1.5 5.3-.6 7.1s-5.3 1.5-7.1-.6l-3.2-3.9-4.9 1.4c-2.7.8-5.6-.8-6.3-3.5-.8-2.7.8-5.6 3.5-6.3l4.9-1.4-.9-5c-.5-2.7 1.3-5.3 4-5.8s5.3 1.3 5.8 4l.9 5zM316 455c-5.3 0-9.6-4.3-9.6-9.6s4.3-9.6 9.6-9.6 9.6 4.3 9.6 9.6-4.3 9.6-9.6 9.6zm-43-21.2 3.9-3.2-4.9-1.4c-2.7-.8-4.3-3.6-3.5-6.3s3.6-4.3 6.3-3.5l4.9 1.4 1.4-4.9c.8-2.7 3.6-4.3 6.3-3.5s4.3 3.6 3.5 6.3l-1.4 4.9 4.7 1.8c2.6 1 3.9 3.9 2.9 6.5s-3.9 3.9-6.5 2.9l-4.7-1.8-.8 5c-.5 2.7-3.1 4.5-5.8 4s-4.5-3.1-4-5.8l.8-5-3.9 3.2c-2.1 1.8-5.3 1.5-7.1-.6s-1.5-5.3.6-7.1zm-90-34c-6.7-6.7-6.7-17.5 0-24.2 6.7-6.7 17.5-6.7 24.2 0s6.7 17.5 0 24.2-17.5 6.7-24.2 0zm240 42c-6.6 0-12-5.4-12-12s5.4-12 12-12 12 5.4 12 12-5.4 12-12 12zm112-200c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm-58-80c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5zm-30 60c-7.7 0-14-6.3-14-14s6.3-14 14-14 14 6.3 14 14-6.3 14-14 14zM194 42c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm-35 8c-7.7 0-14-6.3-14-14s6.3-14 14-14 14 6.3 14 14-6.3 14-14 14zm-40 432c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm310 48c5.5 0 10 4.5 10 10s-4.5 10-10 10-10-4.5-10-10 4.5-10 10-10zm-40-12c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm-74 8c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm-281-18c4.4 0 8 3.6 8 8s-3.6 8-8 8-8-3.6-8-8 3.6-8 8-8zm81-46c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm210-305c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8zm-260-89c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5zm375 53c5 0 9 4 9 9s-4 9-9 9-9-4-9-9 4-9 9-9zm85 305c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10zm-52-157c-2.8 0-5-2.2-5-5s2.2-5 5-5 5 2.2 5 5-2.2 5-5 5zm-82 262c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm-305 35c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm380-50c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zM135 135c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7zm190 50c5.5 0 10 4.5 10 10s-4.5 10-10 10-10-4.5-10-10 4.5-10 10-10zm63 58c1.7 0 3 1.3 3 3s-1.3 3-3 3-3-1.3-3-3 1.3-3 3-3zm-18-222c4.4 0 8 3.6 8 8s-3.6 8-8 8-8-3.6-8-8 3.6-8 8-8zm-275 80c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-45 285c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm360-15c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm-330-330c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm275 430c-3.9 0-7-3.1-7-7s3.1-7 7-7 7 3.1 7 7-3.1 7-7 7zm80-330c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm-245 40c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm420 77c-2.7 0-5-2.3-5-5.1s2.3-5.1 5-5.1 5 2.3 5 5.1c0 2.9-2.3 5.1-5 5.1z' fill='%23333' /%3E%3C/svg%3E");
  opacity: 0.08;
}

.bg-decoration {
  position: fixed;
  z-index: -1;
  opacity: 0.05;
  font-size: 15rem;
  user-select: none;
  animation: float 15s ease-in-out infinite;
}

#lock-icon {
  top: 10%;
  left: 10%;
  transform: rotate(-10deg);
}

#shield-icon {
  bottom: 10%;
  right: 5%;
  transform: rotate(10deg);
}

@keyframes float {
  0%, 100% {
    transform: translateY(0) rotate(-10deg);
  }
  50% {
    transform: translateY(-30px) rotate(0deg);
  }
}

.logo-glow {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at center, rgba(112, 105, 250, 0.7) 0%, transparent 70%);
  border-radius: 9999px;
  opacity: 0.8;
  filter: blur(5px);
  animation: glow 3s ease-in-out infinite;
}

@keyframes glow {
  0%, 100% {
    opacity: 0.7;
  }
  50% {
    opacity: 1;
  }
}

/* Main layout */
.flex {
  display: flex;
}

.h-screen {
  height: 100vh;
}

/* Sidebar */
.sidebar {
  width: 280px;
  /* height: calc(100vh - 72px); */
  background-color: rgba(23, 37, 84, 0.9);
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 72px;
  left: 0;
  bottom: 0;
  z-index: 40;
  overflow: hidden;
  transition: transform 0.3s ease;
}

.light-mode .sidebar {
  background-color: rgba(255, 255, 255, 0.9);
  border-right: 1px solid var(--border-light);
}

/* Sidebar Content Area */
.sidebar-content {
  flex: 1;
  min-height: 0;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  width: 100%;
  overflow: hidden;
}

/* App Brand Styling */
.app-brand {
  width: calc(100% - 2rem);
  margin: 0.3rem 1rem 1rem 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  background-color: rgba(79, 70, 229, 0.3);
  border-radius: 0.75rem;
}

.brand-icon {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 9999px;
  background-color: var(--indigo-600);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
}

.light-mode .brand-icon {
  background-color: var(--indigo-500);
}

.brand-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--white);
  letter-spacing: -0.025em;
}

.light-mode .brand-title {
  color: var(--indigo-900);
}

/* Section Titles */
.sidebar-section-title {
  width: 100%;
  text-align: left;
  padding: 0 1rem;
  margin: 1rem 0 0.5rem 0;
  color: var(--blue-400);
  font-size: 0.75rem;
  text-transform: uppercase;
  font-weight: 600;
  letter-spacing: 0.05em;
}

.light-mode .sidebar-section-title {
  color: var(--blue-900);
}

/* Channel List */
.channel-list {
  width: 100%;
  padding: 0 1rem;
  margin-bottom: 1.5rem;
}

.channel {
  width: 100%;
  padding: 0.75rem 1rem;
  border-radius: 0.5rem;
  margin-bottom: 0.25rem;
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
  cursor: pointer;
  transition: all 0.2s ease;
  color: var(--blue-300);
}

.light-mode .channel {
  color: var(--blue-800);
}

.channel:hover {
  background-color: rgba(30, 64, 175, 0.4);
}

.light-mode .channel:hover {
  background-color: var(--blue-100);
}

.channel.active {
  background-color: rgba(79, 70, 229, 0.8);
  color: var(--white);
  box-shadow: 0 0 8px rgba(99, 102, 241, 0.3);
}

.light-mode .channel.active {
  background-color: var(--indigo-500);
  color: var(--white);
}

.channel-badge {
  background-color: rgba(255, 255, 255, 0.2);
  padding: 0.125rem 0.375rem;
  border-radius: 0.375rem;
  font-size: 0.75rem;
}

.light-mode .channel-badge {
  background-color: rgba(37, 99, 235, 0.2);
}

/* Bottom Section */
.sidebar-bottom {
  width: 100%;
  padding: 1rem;
  background-color: rgba(30, 64, 175, 0.2);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  margin-top: auto;
}

.light-mode .sidebar-bottom {
  background-color: rgba(219, 234, 254, 0.4);
  border-top: 1px solid var(--border-light);
}

/* Settings & Leave Buttons */
/* Settings & Leave Buttons - Updated */
.settings-button, .leave-button {
  width: 100%;
  padding: 0.75rem 1rem;
  margin-bottom: 0.5rem;
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
}

/* Dark Mode Settings Button */
.settings-button {
  background: rgba(59, 130, 246, 0.3); /* Brighter blue background */
  color: var(--blue-200);
  border: 1px solid rgba(59, 130, 246, 0.2);
}

.settings-button:hover {
  background: rgba(59, 130, 246, 0.4);
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Dark Mode Leave Button */
.leave-button {
  background: rgba(220, 38, 38, 0.3); /* Dark red background */
  color: var(--red-300);
  border: 1px solid rgba(220, 38, 38, 0.2);
  margin-bottom: 1rem;
}

.leave-button:hover {
  background: rgba(220, 38, 38, 0.4);
  transform: translateY(-2px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

/* Light Mode Settings Button */
.light-mode .settings-button {
  background-color: var(--blue-50);
  border: 1px solid var(--blue-100);
  color: var(--blue-600);
}

.light-mode .settings-button:hover {
  background-color: var(--blue-100);
  box-shadow: 0 4px 6px rgba(37, 99, 235, 0.1);
}

/* Light Mode Leave Button */
.light-mode .leave-button {
  background-color: rgba(239, 68, 68, 0.1);
  border: 1px solid rgba(239, 68, 68, 0.2);
  color: var(--red-600);
}

.light-mode .leave-button:hover {
  background-color: rgba(239, 68, 68, 0.2);
  box-shadow: 0 4px 6px rgba(239, 68, 68, 0.1);
}

/* User Profile */
.user-profile {
  width: 100%;
  padding: 0.75rem 1rem;
  margin-top: 0.5rem;
  display: flex;
  align-items: center;
  border-radius: 0.5rem;
  background-color: rgba(30, 64, 175, 0.3);
  cursor: pointer;
  transition: all 0.2s ease;
}

.user-profile:hover {
  background-color: rgba(30, 64, 175, 0.4);
}

.light-mode .user-profile {
  background-color: rgba(219, 234, 254, 0.7);
  border-color: var(--border-light);
}

.light-mode .user-profile:hover {
  background-color: rgba(219, 234, 254, 0.9);
}

.avatar-container {
  margin-right: 0.75rem;
}

.avatar {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.user-info {
  display: flex;
  flex-direction: column;
}

.username {
  font-weight: 500;
  color: var(--white);
  font-size: 0.95rem;
}

.light-mode .username {
  color: var(--blue-900);
}

/* Main Content Adjustment */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  padding-top: 72px; /* Height of header */
  width: 100%;
  min-height: 100vh;
}

@media (min-width: 768px) {
  .main-content {
    margin-left: 280px; /* Match sidebar width */
    width: calc(100% - 280px);
  }
  
  .sidebar {
    transform: translateX(0); /* Always visible on desktop */
  }
}

/* Header */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background-color: rgba(23, 37, 84, 0.7);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border-dark);
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  height: 72px;
}

.light-mode .header {
  background-color: rgba(255, 255, 255, 0.9);
  border-bottom: 1px solid var(--border-light);
}

.header-title {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.title {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--white);
  letter-spacing: -0.025em;
}

.light-mode .title {
  color: var(--blue-900);
}

.subtitle {
  color: var(--blue-300);
  font-size: 0.875rem;
  opacity: 0.9;
  margin-top: 0.125rem;
}

.light-mode .subtitle {
  color: var(--blue-600);
}

.header-actions {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.search-bar {
  display: none;
  align-items: center;
  gap: 0.5rem;
  background-color: rgba(30, 64, 175, 0.3);
  border-radius: 8px;
  padding: 0.5rem 0.75rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.2s ease;
}

.search-bar:focus-within {
  background-color: rgba(30, 64, 175, 0.4);
  border-color: rgba(255, 255, 255, 0.2);
}

.light-mode .search-bar {
  background-color: var(--blue-50);
  border: 1px solid var(--blue-100);
}

.light-mode .search-bar:focus-within {
  background-color: var(--white);
  border-color: var(--blue-200);
}

@media (min-width: 768px) {
  .search-bar {
    display: flex;
  }
}

.search-input {
  background-color: transparent;
  border: none;
  outline: none;
  width: 10rem;
  font-size: 0.875rem;
  color: var(--white);
}

.search-input::placeholder {
  color: rgba(147, 197, 253, 0.7);
}

.light-mode .search-input {
  color: var(--blue-950);
}

.light-mode .search-input::placeholder {
  color: rgba(37, 99, 235, 0.7);
}

.icon-button {
  width: 2.25rem;
  height: 2.25rem;
  background-color: rgba(30, 64, 175, 0.7);
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
  cursor: pointer;
  position: relative;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.icon-button:hover {
  background-color: var(--blue-800);
  transform: translateY(-2px);
  box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
}

.icon-button svg {
  color: var(--white); /* This ensures icons are white in dark mode */
}
  
.light-mode .icon-button {
  background-color: var(--blue-100);
}

.light-mode .icon-button:hover {
  background-color: var(--blue-200);
}

.light-mode .icon-button svg {
  color: var(--blue-700); /* This ensures icons are blue in light mode */
}

/* Specifically target the sun and moon icons for theme toggle */
#sun-icon {
  display: block; /* Show sun by default in dark mode */
  color: #facc15;
  filter: drop-shadow(0 0 8px rgba(250, 204, 21, 0.5));
  transition: all 0.3s ease;
}

#moon-icon {
  display: none; /* Hide moon by default in dark mode */
  color: #93c5fd;
  filter: drop-shadow(0 0 8px rgba(147, 197, 253, 0.3));
  transition: all 0.3s ease;
}

.light-mode #sun-icon {
  display: none; /* Hide sun in light mode */
}

.light-mode #moon-icon {
  display: block; /* Show moon in light mode */
}

.icon-button:hover #sun-icon {
  transform: rotate(180deg);
  color: #fde047;
}

.icon-button:hover #moon-icon {
  transform: rotate(180deg);
}

.notification-dot {
  width: 0.5rem;
  height: 0.5rem;
  background-color: var(--red-500);
  border-radius: 9999px;
  position: absolute;
  top: -0.125rem;
  right: -0.125rem;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.2);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Mobile Styles */
@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%); /* Hide off-screen on mobile by default */
    top: 0;
    padding-top: 72px; /* Add padding for header */
    width: 70%;
    z-index: 999;
  }
  
  .sidebar.open {
    transform: translateX(0); /* Show when open class is added */
  }
  
  .sidebar-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 998;
  }
  
  .sidebar-overlay.show {
    display: block;
  }
  
  .menu-toggle {
    display: flex;
  }
  
  .main-content {
    width: 100%;
    margin-left: 0;
  }
  
  .header {
    padding: 0.75rem 1rem;
  }

  .title {
    font-size: 1.25rem;
  }

  .subtitle {
    font-size: 0.75rem;
  }

  .header-actions {
    gap: 0.5rem;
  }

  .icon-button {
    width: 2rem;
    height: 2rem;
  }
  
  .message-input-container {
    padding: 0.75rem;
  }
}

/* Menu Toggle Button */
.menu-toggle {
  background: transparent;
  border: none;
  border-radius: 0.375rem;
  padding: 0.5rem;
  color: var(--white);
  cursor: pointer;
  display: none; /* Hide by default on large screens */
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;
}

.menu-toggle:hover {
  background-color: rgba(30, 64, 175, 0.2);
}

.light-mode .menu-toggle {
  color: var(--blue-800);
}

.menu-toggle svg {
  width: 1.5rem;
  height: 1.5rem;
}

/* Show menu toggle only on mobile */
@media (max-width: 767px) {
  .menu-toggle {
    display: flex; /* Show on mobile */
  }
}

/* Messages Container */
.messages-container {
  flex: 1;
  overflow-y: auto;
  padding: 1.25rem;
  background-image: radial-gradient(circle at center, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
  scrollbar-width: thin;
  scrollbar-color: rgba(59, 130, 246, 0.3) transparent;
  scroll-behavior: smooth;
  animation: smoothScroll 0.3s ease-out;
  position: relative;
  z-index: 1;
}

.messages-container::-webkit-scrollbar {
  width: 6px;
  background-color: transparent;
}

.messages-container::-webkit-scrollbar-track {
  background: transparent;
}

.messages-container::-webkit-scrollbar-thumb {
  background-color: rgba(59, 130, 246, 0.3);
  border-radius: 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.messages-container:hover::-webkit-scrollbar-thumb {
  opacity: 1;
  background-color: rgba(59, 130, 246, 0.5);
}

.light-mode .messages-container::-webkit-scrollbar-thumb {
  background-color: rgba(37, 99, 235, 0.2);
}

.light-mode .messages-container:hover::-webkit-scrollbar-thumb {
  background-color: rgba(37, 99, 235, 0.4);
}

.messages-spacer {
  margin: 1.5rem 0;
}

.date-divider {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 1rem 0;
}

.date-pill {
  padding: 0.25rem 1rem;
  border-radius: 9999px;
  background-color: rgba(30, 64, 175, 0.5);
  color: var(--blue-300);
  font-size: 0.75rem;
}

.light-mode .date-pill {
  background-color: var(--blue-100);
  color: var(--blue-700);
}

.system-message {
  display: flex;
  justify-content: center;
}

.system-message-content {
  background-color: rgba(79, 70, 229, 0.4);
  border: 1px solid rgba(99, 102, 241, 0.3);
  color: var(--blue-300);
  border-radius: 0.5rem;
  padding: 0.5rem 1rem;
  font-size: 0.75rem;
  text-align: center;
  max-width: 20rem;
}

.light-mode .system-message-content {
  background-color: rgba(219, 234, 254, 0.8);
  border: 1px solid rgba(59, 130, 246, 0.2);
  color: var(--blue-700);
}

.message {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  animation: messageEntrance 0.3s ease-out forwards;
  opacity: 0;
}

.message-avatar {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 9999px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.message-avatar:hover {
  transform: scale(1.1) rotate(5deg);
  box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
}

.message-avatar.blue {
  background: linear-gradient(to bottom right, #60a5fa, #2563eb);
}

.message-avatar.green {
  background: linear-gradient(to bottom right, #4ade80, #16a34a);
}

.avatar-face {
  width: 1.5rem;
  height: 1.5rem;
  border-radius: 9999px;
  position: absolute;
}

.avatar-face.blue {
  background-color: var(--blue-800);
}

.avatar-face.green {
  background-color: var(--green-700);
}

.avatar-dot {
  width: 0.375rem;
  height: 0.375rem;
  border-radius: 9999px;
  position: absolute;
}

.avatar-dot.blue {
  background-color: var(--blue-300);
}

.avatar-dot.green {
  background-color: var(--green-300);
}

.avatar-dot.left {
  left: 0.5rem;
  top: 0.5rem;
}

.avatar-dot.right {
  right: 0.5rem;
  top: 0.5rem;
}

.avatar-mouth {
  width: 0.5rem;
  height: 0.125rem;
  border-radius: 9999px;
  position: absolute;
  bottom: 0.5rem;
  transform: translateX(0.125rem);
}

.avatar-mouth.blue {
  background-color: var(--blue-300);
}

.avatar-mouth.green {
  background-color: var(--green-300);
}

.message-content {
  position: relative;
  flex: 1;
}

.message-bubble {
  background-color: rgba(30, 64, 175, 0.8);
  border-radius: 1rem;
  padding: 1rem;
  padding-right: 1.25rem;
  max-width: 85%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--border-dark);
  position: relative;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.message-bubble:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px) scale(1.01);  }

.light-mode .message-bubble {
  background-color: var(--white);
  border: 1px solid var(--border-light);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.03);
}

/* Desktop-specific styles */
@media (min-width: 1024px) {
  .message-bubble {
    max-width: 95%; /* Wider bubbles on desktop */
    padding: 1.25rem 1.5rem; /* More padding */
    font-size: 1.05rem; /* Slightly larger text */
  }
  
  .message-content {
    max-width: 80%; /* Prevents messages from stretching too wide on large screens */
  }
  
  /* For larger screens, we can add more spacing between messages */
  .message {
    margin-bottom: 2rem;
  }
}

.message-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.375rem;
}

.message-sender {
  color: var(--blue-200);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.light-mode .message-sender {
  color: var(--blue-700);
}

.sender-badge {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  border-radius: 9999px;
  background-color: rgba(30, 64, 175, 0.8);
  color: var(--blue-200);
}

.light-mode .sender-badge {
  background-color: var(--blue-100);
  color: var(--blue-700);
}

.message-time {
  color: var(--blue-300);
  font-weight: 500;
}

.light-mode .message-time {
  color: var(--blue-600);
}

.message-text {
  color: var(--white);
  font-size: 1rem;
  line-height: 1.6;
}

.light-mode .message-text {
  color: var(--blue-950);
}

.message-reactions {
  display: flex;
  margin-top: 0.625rem;
  gap: 0.25rem;
}

.reaction {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 9999px;
  background-color: rgba(30, 64, 175, 0.4);
  color: var(--blue-200);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.reaction:hover {
  transform: scale(1.1);
  background-color: rgba(30, 64, 175, 0.7);
}

.light-mode .reaction {
  background-color: var(--blue-100);
  color: var(--blue-700);
}

.light-mode .reaction:hover {
  background-color: var(--blue-200);
}

.reaction.added {
  animation: reactionPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.add-reaction {
  font-size: 0.75rem;
  padding: 0.25rem 0.375rem;
  cursor: pointer;
  transition: opacity 0.2s;
}

.add-reaction:hover {
  opacity: 0.9;
}

.message-actions {
  opacity: 0;
  transform: translateY(5px);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.message-content:hover .message-actions {
  opacity: 1;
  transform: translateY(0);
}

.message-action {
  background: none;
  border: none;
  color: var(--blue-300);
  font-size: 0.875rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  transition: background-color 0.2s ease;
}

.message-action:hover {
  background-color: rgba(30, 64, 175, 0.3);
}

.light-mode .message-action {
  color: var(--blue-600);
}

.light-mode .message-action:hover {
  background-color: var(--blue-100);
}

/* Typing indicator */
/* Typing indicator */
.typing-indicator {
  background-color: rgba(30, 64, 175, 0.6);
  border-radius: 1rem;
  padding: 1rem 1.25rem;
  max-width: 85%;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  border: 1px solid var(--border-dark);
  animation: typingPulse 1.5s infinite;
}

.light-mode .typing-indicator {
  background-color: rgba(255, 255, 255, 0.9);
  border: 1px solid var(--border-light);
}

.typing-dots {
  display: flex;
  gap: 0.375rem;
}

.typing-dot {
  width: 0.5rem;
  height: 0.5rem;
  border-radius: 9999px;
  background-color: var(--blue-400);
  animation: bounce 1s infinite;
}

.light-mode .typing-dot {
  background-color: var(--blue-500);
}

.typing-dot:nth-child(1) {
  animation-delay: -0.3s;
}

.typing-dot:nth-child(2) {
  animation-delay: -0.15s;
}

@keyframes bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-4px);
  }
}

@keyframes typingPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.1);
    opacity: 1;
  }
}

/* Message Input */
.message-input-container {
  position: sticky;
  bottom: 0;
  padding: 0.5rem;
  background-color: rgba(23, 37, 84, 0.7);
  backdrop-filter: blur(12px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  z-index: 20;
}

.light-mode .message-input-container {
  border-top: 1px solid var(--border-light);
  background-color: rgba(255, 255, 255, 0.9);
}

.message-input-wrapper {
  display: flex;
  align-items: center;
  background-color: rgba(30, 41, 59, 0.4);
  border: 1px solid rgba(79, 70, 229, 0.3);
  border-radius: 0.75rem;
  padding: 0.625rem 0.75rem;
  gap: 0.5rem;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: all 0.2s ease;
}

.message-input-wrapper:focus-within {
  border-color: rgba(99, 102, 241, 0.6);
  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
  transform: translateY(-1px);
}

.light-mode .message-input-wrapper {
  background-color: rgba(255, 255, 255, 0.9);
  border: 1px solid var(--blue-200);
}

.light-mode .message-input-wrapper:focus-within {
  border-color: var(--blue-400);
  box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
}

/* Message input responsive adjustments */
@media (max-width: 640px) {
  .message-input-container {
    padding: 0.375rem;
  }
  
  .message-input-wrapper {
    padding: 0.375rem 0.5rem;
  }
  
  .message-input-actions {
    padding: 0.125rem;
    gap: 0.25rem;
  }
  
  .send-button {
    width: 2.125rem;
    height: 2.125rem;
  }
  
  .input-icon-button {
    width: 1.875rem;
    height: 1.875rem;
  }
  
  .message-input {
    padding: 0.3rem 0.375rem;
    font-size: 0.875rem;
    min-height: 36px;
  }
}

@media (max-width: 380px) {
  .message-input-wrapper {
    padding: 0.25rem 0.375rem;
  }
  
  .send-button {
    width: 2rem;
    height: 2rem;
  }
  
  .input-icon-button {
    width: 1.75rem;
    height: 1.75rem;
  }
  
  .message-input {
    padding: 0.25rem;
  }
}

.message-input-actions {
  display: flex;
  gap: 0.375rem;
  padding: 0.25rem;
  color: var(--blue-300);
  flex-shrink: 0;
}

.light-mode .message-input-actions {
  color: var(--blue-600);
}

.input-icon-button {
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(99, 102, 241, 0.3);
  color: var(--white);
  border-radius: 0.5rem;
  width: 2.25rem;
  height: 2.25rem;
  flex-shrink: 0;
  transition: all 0.2s ease;
  cursor: pointer;
}

.input-icon-button:hover {
  background-color: rgba(99, 102, 241, 0.5);
  color: var(--white);
  transform: translateY(-2px);
}

.light-mode .input-icon-button {
  background-color: rgba(99, 102, 241, 0.1);
  color: var(--blue-700);
}

.light-mode .input-icon-button:hover {
  background-color: rgba(99, 102, 241, 0.2);
  color: var(--blue-800);
}

.message-input {
  flex: 1;
  min-height: 40px;
  padding: 0.5rem 0.75rem;
  font-size: 0.95rem;
  background: transparent;
  border: none;
  outline: none;
  color: var(--text-dark);
  border-radius: 0.375rem;
}

.message-input:focus {
  outline: none;
}

.light-mode .message-input {
  color: var(--blue-900);
}

.message-input::placeholder {
  color: rgba(229, 231, 235, 0.7);
  font-size: 0.875rem;
}

.light-mode .message-input::placeholder {
  color: rgba(71, 85, 105, 0.6);
}

.send-button {
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--blue-500);
  color: white;
  border-radius: 0.5rem;
  width: 2.5rem;
  height: 2.5rem;
  flex-shrink: 0;
  border: none;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  cursor: pointer;
  transition: all 0.2s ease;
}

.send-button:hover {
  background-color: var(--blue-400);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
  transform: translateY(-2px);
}

.light-mode .send-button {
  background-color: var(--blue-600);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.light-mode .send-button:hover {
  background-color: var(--blue-700);
}

/* Dark/Light mode toggle */
#dark-mode-toggle {
  display: none;
}

/* Pomodoro Timer Panel */
.pomodoro-panel {
  background-color: #4f46e5;
  border-radius: 0 0 20px 20px;
  padding: 1rem;
  width: 300px;
  position: absolute;
  right: 20px;
  top: 100%;
  z-index: 9999; /* Increased z-index to appear above messages */
  display: none;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.pomodoro-panel.active {
  display: block;
  animation: slideDown 0.3s ease-out;
}

.minimized-timer {
  background-color: #4f46e5;
  border-radius: 0 0 12px 12px;
  padding: 0.5rem 1rem;
  position: absolute;
  right: 20px;
  top: 100%;
  z-index: 9999; /* Increased z-index to match pomodoro panel */
  display: none;
  align-items: center;
  gap: 0.75rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.minimized-timer.active {
  display: flex;
  animation: slideDown 0.3s ease-out;
}

.timer-circle {
  width: 120px;
  height: 120px;
  position: relative;
  margin: 0 auto;
}

.timer-svg {
  transform: rotate(-90deg);
  width: 100%;
  height: 100%;
}

.timer-background {
  fill: none;
  stroke: rgba(255, 255, 255, 0.3);
  stroke-width: 4;
}

.timer-progress {
  fill: none;
  stroke: white;
  stroke-width: 4;
  stroke-linecap: round;
  transition: stroke-dashoffset 0.3s ease;
}

#timer-display {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 1.75rem;
  font-weight: 700;
  color: white;
  font-family: monospace;
}

.minimized-display {
  font-size: 1.25rem;
  font-weight: 700;
  color: white;
  font-family: monospace;
}

.timer-controls {
  display: flex;
  gap: 1rem;
  justify-content: center;
  margin: 1rem 0;
}

.timer-button {
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #4f46e5;
  transition: all 0.2s ease;
}

.timer-button:hover {
  transform: scale(1.1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.timer-button.active {
  background-color: #ef4444;
  color: white;
}

.timer-presets {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 1rem;
}

.preset-button {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 15px;
  padding: 0.375rem 0.75rem;
  color: white;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.preset-button:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

.preset-button.active {
  background: white;
  color: #4f46e5;
}

.window-controls {
  display: flex;
  gap: 0.5rem;
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
}

.window-button {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  transition: all 0.2s ease;
}

.window-button:hover {
  background: rgba(255, 255, 255, 0.3);
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Animation keyframes */
@keyframes messageEntrance {
  0% {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes reactionPop {
  0% {
    transform: scale(0);
  }
  50% {
    transform: scale(1.2);
  }
  100% {
    transform: scale(1);
  }
}

@keyframes smoothScroll {
  from {
    scroll-behavior: smooth;
  }
  to {
    scroll-behavior: smooth;
  }
}

/* User Profile Tooltip */
.user::after {
  content: "View Profile";
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(30, 64, 175, 0.9);
  color: white;
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 0.75rem;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
  white-space: nowrap;
}

.light-mode .user::after {
  background-color: var(--blue-600);
}

.user:hover::after {
  opacity: 1;
}

/* Emoji Picker Styles */
.emoji-picker {
  position: absolute;
  bottom: calc(100% + 10px);
  left: 0;
  width: 320px;
  max-width: 100%;
  background-color: var(--blue-900);
  border: 1px solid rgba(99, 102, 241, 0.3);
  border-radius: 0.75rem;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  z-index: 50;
  overflow: hidden;
  display: none;
  flex-direction: column;
  animation: fadeIn 0.2s ease-out;
}

.light-mode .emoji-picker {
  background-color: var(--white);
  border: 1px solid var(--blue-200);
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
}

.emoji-picker.active {
  display: flex;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.emoji-picker-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem;
  border-bottom: 1px solid rgba(99, 102, 241, 0.2);
}

.emoji-categories {
  display: flex;
  gap: 0.25rem;
  overflow-x: auto;
  padding-bottom: 0.25rem;
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.emoji-categories::-webkit-scrollbar {
  display: none;
}

.emoji-category {
  width: 2rem;
  height: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  background: transparent;
  border: none;
  border-radius: 0.375rem;
  font-size: 1.25rem;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: 0;
}

.emoji-category:hover {
  background-color: rgba(99, 102, 241, 0.2);
}

.emoji-category.active {
  background-color: rgba(99, 102, 241, 0.3);
}

.emoji-close-button {
  background: transparent;
  border: none;
  color: var(--blue-300);
  width: 1.75rem;
  height: 1.75rem;
  border-radius: 0.375rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.emoji-close-button:hover {
  color: var(--white);
  background-color: rgba(99, 102, 241, 0.2);
}

.light-mode .emoji-close-button {
  color: var(--blue-700);
}

.light-mode .emoji-close-button:hover {
  color: var(--blue-800);
}

.emoji-search-container {
  padding: 0.5rem;
  border-bottom: 1px solid rgba(99, 102, 241, 0.2);
}

.emoji-search {
  width: 100%;
  padding: 0.5rem;
  border-radius: 0.375rem;
  background-color: rgba(99, 102, 241, 0.1);
  border: 1px solid rgba(99, 102, 241, 0.2);
  color: var(--text-dark);
  font-size: 0.875rem;
}

.light-mode .emoji-search {
  background-color: rgba(99, 102, 241, 0.05);
  color: var(--text-light);
}

.emoji-search:focus {
  outline: none;
  border-color: rgba(99, 102, 241, 0.4);
}

.emoji-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 0.25rem;
  padding: 0.5rem;
  max-height: 250px;
  overflow-y: auto;
}

.emoji-item {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  font-size: 1.25rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.emoji-item:hover {
  background-color: rgba(99, 102, 241, 0.2);
  transform: scale(1.1);
}

@media (max-width: 640px) {
  .emoji-picker {
    width: 100%;
    left: 0;
    right: 0;
  }
  
  .emoji-grid {
    grid-template-columns: repeat(7, 1fr);
  }
}

@media (max-width: 380px) {
  .emoji-grid {
    grid-template-columns: repeat(6, 1fr);
  }
  
  .emoji-category {
    width: 1.75rem;
    height: 1.75rem;
    font-size: 1rem;
  }
}

/* Mobile sidebar styles */
@media (max-width: 767px) {
  .sidebar {
    transform: translateX(-100%);
    /* width: 260px; */
  }
  
  .sidebar.open {
    transform: translateX(0);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
  }
  
  .main-content {
    margin-left: 0 !important;
  }
  
  body.sidebar-open {
    overflow: hidden;
  }
}

/* Sidebar overlay */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 39;
  display: none;
}

.sidebar-overlay.show {
  display: block;
}

/* Menu toggle button */
.menu-toggle {
  background: transparent;
  border: none;
  border-radius: 0.375rem;
  padding: 0.5rem;
  color: var(--white);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s;
}

.menu-toggle:hover {
  background-color: rgba(30, 64, 175, 0.2);
}

.light-mode .menu-toggle {
  color: var(--blue-800);
}

.menu-toggle svg {
  width: 1.5rem;
  height: 1.5rem;
}

/* Hide menu toggle on desktop, show on mobile */
@media (min-width: 768px) {
  .menu-toggle, #menu-toggle {
    display: none !important;
  }
}

@media (max-width: 767px) {
  .menu-toggle, #menu-toggle {
    display: flex !important;
  }
}
    </style>
    
    

  </head>
  <body>
    <input type="checkbox" id="dark-mode-toggle" onchange="document.body.classList.toggle('light-mode')">

    <div class="bg-decoration" id="lock-icon">üîí</div>
    <div class="bg-decoration" id="shield-icon">üõ°Ô∏è</div>

    <div class="flex h-screen">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-content">
          <!-- App Brand -->
          <div class="app-brand">
            <div class="brand-icon">
              <div class="logo-glow"></div>
              <i data-lucide="users" class="text-indigo-200"></i>
            </div>
            <span class="brand-title">Campus Connect</span>
          </div>

          <div class="sidebar-section-title">CHANNELS</div>
          <div class="channel-list">
            <div class="channel active" onclick="handleNavigation('/chat', event)">
              <i data-lucide="hash"></i>
              <span>General</span>
            </div>
            <div class="channel" onclick="handleNavigation('/social-feed', event)">
              <i data-lucide="users"></i>
              <span>Social Feed</span>
            </div>
          </div>
        </div>

        <div class="sidebar-bottom">
          <button class="settings-button">
            <i data-lucide="settings"></i>
            <span>Settings</span>
          </button>
          <button class="leave-button">
            <i data-lucide="log-out"></i>
            <span>Leave Chat</span>
          </button>
          
          <!-- User Profile -->
          <div class="user-profile" onclick="handleNavigation('/profile', event)">
            <div class="avatar-container">
              <div class="avatar bg-blue" id="user-avatar">
                <!-- DiceBear avatar will be inserted here by updateUserAvatar() function -->
              </div>
            </div>
            <div class="user-info">
              <span class="username">Anonymous</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar Overlay -->
      <div class="sidebar-overlay"></div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Header -->
        <div class="header">
          <div class="header-title">
            <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <div>
              <h1 class="title">University Chat</h1>
              <p class="subtitle">Anonymous chat room</p>
            </div>
          </div>

          <div class="header-actions">
            <div class="search-bar">
              <i data-lucide="search" width="16" height="16" class="text-blue-300"></i>
              <input type="text" placeholder="Search messages..." class="search-input">
            </div>
            
            <button id="dark-mode-button" class="icon-button">
              <i id="sun-icon" data-lucide="sun" class="text-yellow-300"></i>
              <i id="moon-icon" data-lucide="moon" class="text-blue-700" style="display:none"></i>
            </button>
            
            <div style="position: relative;">
              <i data-lucide="bell" width="24" height="24" class="text-white"></i>
              <div class="notification-dot"></div>
            </div>
          </div>

          <!-- Single Pomodoro Panel -->
          <div id="pomodoro-panel" class="pomodoro-panel">
            <div class="window-controls">
              <button class="window-button" id="minimize-timer">
                <i data-lucide="minus" width="14" height="14"></i>
              </button>
              <button class="window-button" id="close-timer">
                <i data-lucide="x" width="14" height="14"></i>
              </button>
            </div>
            <div class="timer-container">
              <div class="timer-circle">
                <svg class="timer-svg" viewBox="0 0 100 100">
                  <circle class="timer-background" cx="50" cy="50" r="45"/>
                  <circle class="timer-progress" cx="50" cy="50" r="45"/>
                </svg>
                <div id="timer-display">00:00</div>
              </div>
              <div class="timer-controls">
                <button class="timer-button" id="timer-start">
                  <i data-lucide="play" width="20" height="20"></i>
                </button>
                <button class="timer-button" id="timer-reset">
                  <i data-lucide="rotate-ccw" width="20" height="20"></i>
                </button>
              </div>
              <div class="timer-presets">
                <button class="preset-button" data-time="60">1m</button>
                <button class="preset-button" data-time="300">5m</button>
                <button class="preset-button" data-time="600">10m</button>
                <button class="preset-button" data-time="900">15m</button>
                <button class="preset-button" data-time="1800">30m</button>
              </div>
            </div>
          </div>

          <!-- Minimized Timer -->
          <div id="minimized-timer" class="minimized-timer">
            <span class="minimized-display">00:00</span>
            <button class="window-button" id="maximize-timer">
              <i data-lucide="maximize-2" width="14" height="14"></i>
            </button>
          </div>
        </div><!-- End header -->

        <!-- Messages Container -->
        <div class="messages-container">
          <!-- Date Divider -->
          <div class="date-divider">
            <div class="date-pill">
              Today, April 9
            </div>
          </div>

          <!-- System Message -->
          <div class="system-message">
            <div class="system-message-content">
              Alex joined the channel
            </div>
          </div>

          <div class="messages-spacer"></div>

          <!-- Message 1 -->
          <div class="message">
            <div class="message-avatar blue">
              <div class="avatar-face blue">
                <div class="avatar-dot blue left"></div>
                <div class="avatar-dot blue right"></div>
                <div class="avatar-mouth blue"></div>
              </div>
            </div>
            <div class="message-content">
              <div class="message-bubble">
                <div class="message-header">
                  <span class="message-sender">
                    Anonymous
                  </span>
                  <span class="message-time">9:30 AM</span>
                </div>
                <p class="message-text">
                  Does anyone know if the library is open late during finals week?
                </p>
                <div class="message-reactions">
                  <span class="reaction">
                    üëç 2
                  </span>
                  <span class="add-reaction">
                    +
                  </span>
                </div>
              </div>
              <div class="message-actions">
                <button class="message-action reply">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
                  </svg>
                  Reply
                </button>
              </div>
            </div>
          </div>

          <!-- Message 2 -->
          <div class="message">
            <div class="message-avatar blue">
              <div class="avatar-face blue">
                <div class="avatar-dot blue left"></div>
                <div class="avatar-dot blue right"></div>
                <div class="avatar-mouth blue"></div>
              </div>
            </div>
            <div class="message-content">
              <div class="message-bubble">
                <div class="message-header">
                  <span class="message-sender">
                    Anonymous
                  </span>
                  <span class="message-time">9:32 AM</span>
                </div>
                <p class="message-text">
                  Yeah, it's open until 2 AM starting next Monday.
                </p>
                <div class="message-reactions">
                  <span class="reaction">
                    üôè 3
                  </span>
                </div>
              </div>
              <div class="message-actions">
                <button class="message-action reply">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
                  </svg>
                  Reply
                </button>
              </div>
            </div>
          </div>

          <!-- Typing Indicator -->
          <div class="message">
            <div class="message-avatar green">
              <div class="avatar-face green">
                <div class="avatar-dot green left"></div>
                <div class="avatar-dot green right"></div>
                <div class="avatar-mouth green"></div>
              </div>
            </div>
            <div class="typing-indicator">
              <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
              </div>
            </div>
          </div>
        </div><!-- End messages-container -->

        <!-- Message Input -->
        <div class="message-input-container">
          <div class="message-input-wrapper">
            <div class="message-input-actions">
              <button id="emoji-toggle" class="input-icon-button">
                <i data-lucide="smile" width="18" height="18"></i>
              </button>
            </div>
            <input type="text" placeholder="Type a message..." class="message-input">
            <button class="send-button">
              <i data-lucide="send" width="20" height="20" class="send-icon text-white"></i>
            </button>
          </div>
          
          <!-- Emoji Picker -->
          <div id="emoji-picker" class="emoji-picker">
            <div class="emoji-picker-header">
              <div class="emoji-categories">
                <button class="emoji-category active" data-category="smileys">üòä</button>
                <button class="emoji-category" data-category="animals">üê∂</button>
                <button class="emoji-category" data-category="food">üçï</button>
                <button class="emoji-category" data-category="travel">‚úàÔ∏è</button>
                <button class="emoji-category" data-category="activities">‚öΩ</button>
                <button class="emoji-category" data-category="objects">üí°</button>
                <button class="emoji-category" data-category="symbols">‚ù§Ô∏è</button>
                <button class="emoji-category" data-category="flags">üè≥Ô∏è</button>
              </div>
              <button id="emoji-close" class="emoji-close-button">
                <i data-lucide="x" width="16" height="16"></i>
              </button>
            </div>
            <div class="emoji-search-container">
              <input type="text" placeholder="Search emojis..." class="emoji-search">
            </div>
            <div class="emoji-grid" id="emoji-grid">
              <!-- Emojis will be inserted here dynamically -->
            </div>
          </div>
        </div>
      </div><!-- End main-content -->
    </div><!-- End flex h-screen -->
  <script>
  // DOM ready event handler
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM fully loaded, initializing chat');
    lucide.createIcons();
    
    // Function to update user's avatar with DiceBear and selected color
    function updateUserAvatar() {
      const selectedGravatar = localStorage.getItem('selectedGravatar') || 'bottts';
      const selectedSeed = localStorage.getItem('selectedSeed') || 'Felix';
      const selectedColor = localStorage.getItem('selectedColor') || 'blue';
      const userAvatars = document.querySelectorAll('.user-avatar, .avatar-container .avatar, #user-avatar');
      
      userAvatars.forEach(avatar => {
        // Reset classes and add selected color
        avatar.className = avatar.className.replace(/bg-\w+/g, '');
        avatar.classList.add(`bg-${selectedColor}`);
        
        // Clear any previous content
        avatar.innerHTML = '';
        
        // Create DiceBear image based on selected style
        const gravatar = document.createElement('img');
        gravatar.src = `https://api.dicebear.com/7.x/${selectedGravatar}/svg?seed=${selectedSeed}`;
        gravatar.alt = 'User Avatar';
        gravatar.style.width = '100%';
        gravatar.style.height = '100%';
        gravatar.style.objectFit = 'cover';
        
        // Add image to avatar container
        avatar.appendChild(gravatar);
      });
      
      // Also update message avatars
      updateMessageAvatars();
    }
    
    // Function to update all message avatars in the chat
    function updateMessageAvatars() {
      const messageAvatars = document.querySelectorAll('.message-avatar');
      if (messageAvatars.length === 0) return;
      
      messageAvatars.forEach(avatar => {
        // Get sender name or use default
        const senderElement = avatar.closest('.message')?.querySelector('.message-sender');
        const sender = senderElement ? senderElement.textContent.trim() : 'anonymous';
        
        // Generate a consistent hash based on the sender's name
        const hash = Array.from(sender.toLowerCase())
          .reduce((acc, char) => acc + char.charCodeAt(0).toString(16), '')
          .substring(0, 32)
          .padEnd(32, '0');
        
        // Generate a consistent color based on the sender's name
        const colors = ['blue', 'purple', 'green', 'yellow', 'pink', 'teal', 'orange', 'red'];
        const colorIndex = Array.from(sender.toLowerCase()).reduce((acc, char) => acc + char.charCodeAt(0), 0) % colors.length;
        const avatarColor = colors[colorIndex];
        
        // Clear previous content and add color class
        avatar.innerHTML = '';
        avatar.className = avatar.className.replace(/bg-\w+/g, '');
        avatar.classList.add(`bg-${avatarColor}`);
        
        // Generate DiceBear avatar for the message sender
        const diceBearStyles = ['bottts', 'adventurer', 'lorelei', 'fun-emoji', 'micah', 'open-peeps', 'croodles', 'thumbs'];
        const diceBearStyle = diceBearStyles[Math.abs(hash.charCodeAt(0)) % diceBearStyles.length];
        
        // Create and add the diceBear image
        const gravatar = document.createElement('img');
        gravatar.src = `https://api.dicebear.com/7.x/${diceBearStyle}/svg?seed=${sender}`;
        gravatar.alt = 'User Avatar';
        gravatar.style.width = '100%';
        gravatar.style.height = '100%';
        gravatar.style.objectFit = 'cover';
        
        avatar.appendChild(gravatar);
      });
    }
    
    // Function to add new message to UI with DiceBear and colored background
    function addMessageToUI(text) {
      const messagesContainer = document.querySelector('.messages-container');
      if (!messagesContainer) return;
      
      const messageEl = document.createElement('div');
      messageEl.className = 'message';
      
      // Use the selected avatar style and color for user messages
      const selectedGravatar = localStorage.getItem('selectedGravatar') || 'bottts';
      const selectedSeed = localStorage.getItem('selectedSeed') || 'Felix';
      const selectedColor = localStorage.getItem('selectedColor') || 'blue';
      
      const currentTime = new Date();
      const hours = currentTime.getHours();
      const minutes = currentTime.getMinutes();
      const timeString = `${hours}:${minutes < 10 ? '0' + minutes : minutes} ${hours >= 12 ? 'PM' : 'AM'}`;
      
      messageEl.innerHTML = `
        <div class="message-avatar bg-${selectedColor}">
          <img src="https://api.dicebear.com/7.x/${selectedGravatar}/svg?seed=${selectedSeed}" 
              alt="User Avatar" 
              style="width: 100%; height: 100%; object-fit: cover;">
        </div>
        <div class="message-content">
          <div class="message-bubble">
            <div class="message-header">
              <span class="message-sender">
                You
              </span>
              <span class="message-time">${timeString}</span>
            </div>
            <p class="message-text">${text}</p>
          </div>
          <div class="message-actions">
            <button class="message-action reply">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"></path>
              </svg>
              Reply
            </button>
          </div>
        </div>
      `;
      
      messagesContainer.appendChild(messageEl);
      
      // Scroll to the new message
      messagesContainer.scrollTo({
        top: messagesContainer.scrollHeight,
        behavior: 'smooth'
      });
    }
    
    // Initialize avatars with selected color
    updateUserAvatar();
    
    // Set up message sending with colored avatar
    const sendButton = document.querySelector('.send-button');
    const messageInput = document.querySelector('.message-input');
    
    if (sendButton && messageInput) {
      sendButton.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
          addMessageToUI(message);
          messageInput.value = '';
        }
      });
      
      // Also handle Enter key
      messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendButton.click();
        }
      });
    }
    
    // Add CSS for avatar colors
    const avatarStyles = document.createElement('style');
    avatarStyles.textContent = `
      .bg-blue { background-color: #4285f4; }
      .bg-purple { background-color: #a142f4; }
      .bg-green { background-color: #34a853; }
      .bg-yellow { background-color: #fbbc05; }
      .bg-pink { background-color: #ea4c89; }
      .bg-teal { background-color: #20c997; }
      .bg-orange { background-color: #ff7a45; }
      .bg-red { background-color: #ea4335; }
    `;
    document.head.appendChild(avatarStyles);
    
    // Initialize emoji picker
    const emojiToggle = document.getElementById('emoji-toggle');
    const emojiPicker = document.getElementById('emoji-picker');
    const emojiClose = document.getElementById('emoji-close');
    const emojiGrid = document.getElementById('emoji-grid');
    const emojiSearch = document.querySelector('.emoji-search');
    const emojiCategories = document.querySelectorAll('.emoji-category');
    
    // Emoji data by category with names for search
    const emojiData = {
      smileys: [
        {emoji: 'üòÄ', name: 'grinning face smile happy'},
        {emoji: 'üòÉ', name: 'grinning face with big eyes smile happy'},
        {emoji: 'üòÑ', name: 'grinning face with smiling eyes happy smile'},
        {emoji: 'üòÅ', name: 'beaming face with smiling eyes happy smile'},
        {emoji: 'üòÜ', name: 'grinning squinting face happy smile laugh'},
        {emoji: 'üòÖ', name: 'grinning face with sweat smile relieved'},
        {emoji: 'üòÇ', name: 'face with tears of joy laugh crying happy'},
        {emoji: 'ü§£', name: 'rolling on the floor laughing happy laugh'},
        {emoji: 'üòä', name: 'smiling face with smiling eyes happy blush'},
        {emoji: 'üòá', name: 'smiling face with halo angel innocent'},
        {emoji: 'üôÇ', name: 'slightly smiling face happy'},
        {emoji: 'üôÉ', name: 'upside-down face silly playful'},
        {emoji: 'üòâ', name: 'winking face flirt wink'},
        {emoji: 'üòå', name: 'relieved face calm relaxed'},
        {emoji: 'üòç', name: 'smiling face with heart-eyes love crush heart'},
        {emoji: 'ü•∞', name: 'smiling face with hearts love affection'},
        {emoji: 'üòò', name: 'face blowing a kiss love flirt'},
        {emoji: 'üòó', name: 'kissing face love'},
        {emoji: 'üòô', name: 'kissing face with smiling eyes love happy'},
        {emoji: 'üòö', name: 'kissing face with closed eyes love shy'},
        {emoji: 'üòã', name: 'face savoring food yum tasty delicious'},
        {emoji: 'üòõ', name: 'face with tongue silly playful'},
        {emoji: 'üòù', name: 'squinting face with tongue silly playful'},
        {emoji: 'üòú', name: 'winking face with tongue silly playful'},
        {emoji: 'ü§™', name: 'zany face silly crazy'},
        {emoji: 'ü§®', name: 'face with raised eyebrow skeptical suspicious'},
        {emoji: 'üßê', name: 'face with monocle sophisticated curious'},
        {emoji: 'ü§ì', name: 'nerd face geek smart glasses'},
        {emoji: 'üòé', name: 'smiling face with sunglasses cool'},
        {emoji: 'ü§©', name: 'star-struck excited impressed'},
        {emoji: 'ü•≥', name: 'partying face celebration birthday party'},
        {emoji: 'üòè', name: 'smirking face flirt smug'}
      ],
      animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêí', 'üêî', 'üêß', 'üê¶', 'üê§', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù'],
      food: ['üçè', 'üçé', 'üçê', 'üçä', 'üçã', 'üçå', 'üçâ', 'üçá', 'üçì', 'üçà', 'üçí', 'üçë', 'ü•≠', 'üçç', 'ü••', 'ü•ù', 'üçÖ', 'üçÜ', 'ü•ë', 'ü•¶', 'ü•¨', 'ü•í', 'üå∂', 'üåΩ', 'ü•ï', 'üßÑ', 'üßÖ', 'ü•î', 'üç†', 'ü•ê', 'ü•Ø', 'üçû'],
      travel: ['‚úàÔ∏è', 'üöó', 'üöï', 'üöô', 'üöå', 'üöé', 'üèé', 'üöì', 'üöë', 'üöí', 'üöê', 'üöö', 'üöõ', 'üöú', 'üõ¥', 'üö≤', 'üõµ', 'üèç', 'üöÇ', 'üöÜ', 'üöá', 'üöä', 'üöâ', 'üöÅ', 'üõ©', '‚õµÔ∏è', 'üõ•', 'üö¢', '‚öìÔ∏è', 'üöß', '‚õΩÔ∏è', 'üöè'],
      activities: ['‚öΩÔ∏è', 'üèÄ', 'üèà', '‚öæÔ∏è', 'ü•é', 'üéæ', 'üèê', 'üèâ', 'ü•è', 'üé±', 'ü™Ä', 'üèì', 'üè∏', 'üèí', 'üèë', 'ü•ç', 'üèè', 'ü•Ö', '‚õ≥Ô∏è', 'ü™Å', 'üèπ', 'üé£', 'ü§ø', 'ü•ä', 'ü•ã', 'üéΩ', 'üõπ', 'üõ∑', '‚õ∏', 'ü•å', 'üéø', '‚õ∑'],
      objects: ['‚åöÔ∏è', 'üì±', 'üì≤', 'üíª', '‚å®Ô∏è', 'üñ•', 'üñ®', 'üñ±', 'üñ≤', 'üïπ', 'üóú', 'üíΩ', 'üíæ', 'üíø', 'üìÄ', 'üìº', 'üì∑', 'üì∏', 'üìπ', 'üé•', 'üìΩ', 'üéû', 'üìû', '‚òéÔ∏è', 'üìü', 'üì†', 'üì∫', 'üìª', 'üéô', 'üéö', 'üéõ', 'üß≠'],
      symbols: ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíî', '‚ù£Ô∏è', 'üíï', 'üíû', 'üíì', 'üíó', 'üíñ', 'üíò', 'üíù', 'üíü', '‚òÆÔ∏è', '‚úùÔ∏è', '‚ò™Ô∏è', 'üïâ', '‚ò∏Ô∏è', '‚ú°Ô∏è', 'üîØ', 'üïé', '‚òØÔ∏è', '‚ò¶Ô∏è', 'üõê', '‚õé', '‚ôàÔ∏è'],
      flags: ['üè≥Ô∏è', 'üè¥', 'üèÅ', 'üö©', 'üè≥Ô∏è', 'üá∫üá≥', 'üá¶üá´', 'üá¶üáΩ', 'üá¶üá±', 'üá©üáø', 'üá¶üá∏', 'üá¶üá©', 'üá¶üá¥', 'üá¶üáÆ', 'üá¶üá∂', 'üá¶üá¨', 'üá¶üá∑', 'üá¶üá≤', 'üá¶üáº', 'üá¶üá∫', 'üá¶üáπ', 'üá¶üáø', 'üáßüá∏', 'üáßüá≠', 'üáßüá©', 'üáßüáß', 'üáßüáæ', 'üáßüá™', 'üáßüáø', 'üáßüáØ', 'üáßüá≤']
    };
    
    // Keywords for searching emoji categories
    const categoryKeywords = {
      smileys: 'face happy smile sad angry laugh cry emotion feeling expression',
      animals: 'animal pet dog cat bird zoo wildlife nature farm domestic wild',
      food: 'food fruit vegetable meal eat drink dinner lunch breakfast cooking',
      travel: 'travel car plane train ship boat transportation vehicle trip vacation',
      activities: 'sports game play activity exercise hobby recreation sport fun',
      objects: 'object tool device gadget technology item thing equipment',
      symbols: 'symbol sign heart love religion religious spiritual icon',
      flags: 'flag country nation international world global region'
    };
    
    // Function to insert emoji into message input
    function insertEmoji(emoji) {
      if (!messageInput) return;
      
      console.log('Inserting emoji:', emoji);
      
      // Get cursor position
      const cursorPos = messageInput.selectionStart;
      
      // Get current message text
      const currentText = messageInput.value;
      
      // Insert emoji at cursor position
      const newText = currentText.substring(0, cursorPos) + emoji + currentText.substring(cursorPos);
      
      // Update message input value
      messageInput.value = newText;
      
      // Move cursor after inserted emoji
      const newCursorPos = cursorPos + emoji.length;
      messageInput.setSelectionRange(newCursorPos, newCursorPos);
      
      // Focus back on the input
      messageInput.focus();
      
      // Close emoji picker
      if (emojiPicker) {
        emojiPicker.classList.remove('active');
      }
    }
    
    // Function to populate emoji grid based on selected category
    function populateEmojiGrid(category) {
      emojiGrid.innerHTML = '';
      
      // Get the emojis for the selected category
      const categoryEmojis = emojiData[category];
      
      // Create and append emoji items to the grid
      categoryEmojis.forEach(item => {
        const emojiItem = document.createElement('div');
        emojiItem.className = 'emoji-item';
        
        // Handle both simple emoji strings and objects with emoji/name properties
        if (typeof item === 'object') {
          emojiItem.textContent = item.emoji;
          emojiItem.title = item.name;
          emojiItem.addEventListener('click', () => insertEmoji(item.emoji));
        } else {
          emojiItem.textContent = item;
          emojiItem.addEventListener('click', () => insertEmoji(item));
        }
        
        emojiGrid.appendChild(emojiItem);
      });
    }
    
    // Function to search emojis
    function searchEmojis(query) {
      // Log for debugging
      console.log('Search query:', query);
      
      if (!query) {
        // If search is cleared, show the current category
        const activeCategory = document.querySelector('.emoji-category.active').dataset.category;
        populateEmojiGrid(activeCategory);
        return;
      }
      
      emojiGrid.innerHTML = '';
      query = query.toLowerCase().trim();
      
      // These are emoji category keywords to improve search
      const emojiKeywords = {
        'üòÄ': 'smile happy face grin',
        'üòÉ': 'smile happy face grin',
        'üòÑ': 'smile happy face laugh',
        'üê∂': 'dog puppy animal pet',
        'üê±': 'cat kitten animal pet',
        'üçè': 'apple fruit food green',
        'üçé': 'apple fruit food red',
        '‚úàÔ∏è': 'airplane travel flight',
        'üöó': 'car drive travel',
        '‚öΩÔ∏è': 'soccer football sport ball',
        'üèÄ': 'basketball sport ball',
        '‚åöÔ∏è': 'watch time clock',
        'üì±': 'phone mobile smartphone',
        '‚ù§Ô∏è': 'heart love red',
        'üß°': 'heart love orange',
        'üè≥Ô∏è': 'flag white',
        'üè¥': 'flag black'
      };
      
      // Search in all categories
      let results = [];
      
      // Loop through all categories
      for (const category in emojiData) {
        emojiData[category].forEach(emoji => {
          // Try to match against keywords if available
          if (emojiKeywords[emoji] && emojiKeywords[emoji].includes(query)) {
            results.push(emoji);
          } 
          // Also check if the query is part of the category name
          else if (category.toLowerCase().includes(query)) {
            results.push(emoji);
          }
          // Fallback to simple emoji comparison 
          else if (emoji.includes(query)) {
            results.push(emoji);
          }
        });
      }
      
      // Limit results to avoid overwhelming
      results = results.slice(0, 32);
      
      // Add search results to the grid
      if (results.length > 0) {
        results.forEach(emoji => {
          const emojiItem = document.createElement('div');
          emojiItem.className = 'emoji-item';
          emojiItem.textContent = emoji;
          emojiItem.addEventListener('click', () => insertEmoji(emoji));
          emojiGrid.appendChild(emojiItem);
        });
      } else {
        // Show a message if no results found
        const noResults = document.createElement('div');
        noResults.style.gridColumn = '1 / -1';
        noResults.style.textAlign = 'center';
        noResults.style.padding = '1rem';
        noResults.style.color = 'var(--blue-300)';
        noResults.textContent = 'No emojis found';
        emojiGrid.appendChild(noResults);
      }
    }
    
    // Set up event listeners for emoji picker
    if (emojiToggle && emojiPicker && emojiClose) {
      // Function to toggle emoji picker visibility
      function toggleEmojiPicker() {
        console.log('Toggling emoji picker');
        emojiPicker.classList.toggle('active');
        
        // If opening the picker, focus the search field
        if (emojiPicker.classList.contains('active')) {
          // Show smileys category by default if none is active
          if (!document.querySelector('.emoji-category.active')) {
            const smileysCategory = document.querySelector('.emoji-category[data-category="smileys"]');
            if (smileysCategory) {
              smileysCategory.classList.add('active');
              populateEmojiGrid('smileys');
            }
          } else {
            // Otherwise show the current active category
            const activeCategory = document.querySelector('.emoji-category.active').dataset.category;
            populateEmojiGrid(activeCategory);
          }
          
          // Focus the search input after a small delay to ensure the picker is visible
          setTimeout(() => {
            if (emojiSearch) emojiSearch.focus();
          }, 100);
        }
      }
      
      // Toggle emoji picker when clicking the emoji button
      emojiToggle.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent event bubbling
        toggleEmojiPicker();
      });
      
      // Close emoji picker when clicking the close button
      emojiClose.addEventListener('click', () => {
        emojiPicker.classList.remove('active');
      });
      
      // Category selection
      emojiCategories.forEach(category => {
        category.addEventListener('click', () => {
          // Update active class
          emojiCategories.forEach(c => c.classList.remove('active'));
          category.classList.add('active');
          
          // Populate with selected category
          populateEmojiGrid(category.dataset.category);
          
          // Clear search
          emojiSearch.value = '';
        });
      });
      
      // Search functionality
      emojiSearch.addEventListener('input', (e) => {
        const searchQuery = e.target.value.trim().toLowerCase();
        console.log('Searching for:', searchQuery);
        
        if (!searchQuery) {
          // If search is empty, show the current category
          const activeCategory = document.querySelector('.emoji-category.active').dataset.category;
          populateEmojiGrid(activeCategory);
          return;
        }
        
        // Clear the grid
        emojiGrid.innerHTML = '';
        
        // Search through all categories for matches
        let found = false;
        let resultCount = 0;
        const maxResults = 24;
        
        // Category keywords for better search
        const categories = {
          smileys: 'smile face happy sad angry laugh cry emotion surprised worried grin wink',
          animals: 'animal dog cat pet bird fish bear monkey panda lion frog',
          food: 'food fruit banana apple orange pizza burger drink coffee tea',
          travel: 'travel car plane train bus ship boat rocket world map',
          activities: 'sport ball game play soccer basketball tennis gym fitness',
          objects: 'phone computer watch clock book pencil tool light',
          symbols: 'heart star arrow love symbol music note math',
          flags: 'flag country nation world'
        };
        
        // Popular emoji keywords
        const emojiKeywords = {
          'üòÄ': 'smile grin happy face',
          'üòÇ': 'laugh joy crying tears',
          'üòä': 'smile blush happy',
          'üòç': 'love heart eyes',
          'üòé': 'cool sunglasses',
          'üôÅ': 'sad frown unhappy',
          'üò¢': 'cry sad tear',
          'ü•∞': 'love hearts affection',
          'üëç': 'thumbs up good like',
          'üëã': 'wave hello goodbye hand',
          'üôè': 'pray thanks please',
          'üí™': 'muscle strong flex',
          'üê∂': 'dog puppy animal pet',
          'üê±': 'cat kitten animal pet',
          'üåç': 'earth world globe planet',
          'üåÆ': 'taco food mexican',
          'üçï': 'pizza food slice',
          'üöó': 'car drive transport',
          'üíñ': 'heart love sparkle',
          '‚≠ê': 'star favorite'
        };
        
        // First check if query matches emoji keywords
        for (const category in emojis) {
          for (const emoji of emojis[category]) {
            // Check if emoji is in our keywords map
            if (emojiKeywords[emoji] && emojiKeywords[emoji].includes(searchQuery)) {
              const emojiItem = document.createElement('div');
              emojiItem.className = 'emoji-item';
              emojiItem.textContent = emoji;
              emojiItem.addEventListener('click', () => insertEmoji(emoji));
              emojiGrid.appendChild(emojiItem);
              found = true;
              resultCount++;
              
              if (resultCount >= maxResults) break;
            }
          }
          if (resultCount >= maxResults) break;
        }
        
        // Check if query matches category keywords
        if (resultCount < maxResults) {
          for (const category in categories) {
            if (categories[category].includes(searchQuery)) {
              // If query matches category, show all emojis from that category
              emojis[category].forEach(emoji => {
                if (resultCount < maxResults) {
                  const emojiItem = document.createElement('div');
                  emojiItem.className = 'emoji-item';
                  emojiItem.textContent = emoji;
                  emojiItem.addEventListener('click', () => insertEmoji(emoji));
                  emojiGrid.appendChild(emojiItem);
                  found = true;
                  resultCount++;
                }
              });
            }
          }
        }
        
        // If no results were found
        if (!found) {
          // Show a no results message
          const noResults = document.createElement('div');
          noResults.style.gridColumn = '1 / -1';
          noResults.style.textAlign = 'center';
          noResults.style.padding = '1rem';
          noResults.style.color = 'var(--blue-300)';
          noResults.textContent = 'Try searching for: smile, happy, love, animal, food';
          emojiGrid.appendChild(noResults);
        }
      });
      
      // Prevent losing focus when typing in search
      emojiSearch.addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      // Close emoji picker when clicking outside
      document.addEventListener('click', (e) => {
        if (emojiPicker.classList.contains('active') && 
            !emojiPicker.contains(e.target) && 
            e.target !== emojiToggle) {
          emojiPicker.classList.remove('active');
        }
      });
    }
    
    // Theme toggle functionality
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const darkModeButton = document.getElementById('dark-mode-button');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');
    
    // Check for saved theme preference or use system preference
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const currentTheme = localStorage.getItem('theme');
    
    // Set initial theme
    if (currentTheme === 'light') {
      document.body.classList.add('light-mode');
      sunIcon.style.display = 'none';
      moonIcon.style.display = 'block';
      darkModeToggle.checked = true;
    } else if (currentTheme === 'dark' || prefersDarkScheme.matches) {
      document.body.classList.remove('light-mode');
      sunIcon.style.display = 'block';
      moonIcon.style.display = 'none';
      darkModeToggle.checked = false;
    }

    // Handle theme toggle button click
    darkModeButton.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      const isLightMode = document.body.classList.contains('light-mode');
      localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
      
      if (isLightMode) {
        sunIcon.style.display = 'none';
        moonIcon.style.display = 'block';
        darkModeToggle.checked = true;
      } else {
        sunIcon.style.display = 'block';
        moonIcon.style.display = 'none';
        darkModeToggle.checked = false;
      }
    });

    // Navigation handling function
    function handleNavigation(path, e) {
      if (e) {
        e.preventDefault();
      }
      console.log('Global handleNavigation called with path:', path);
      
      // Navigate directly to the specified path without confirmation
      window.location.href = path;
    }

    // Menu Toggle / Sidebar Functionality
    const menuToggle = document.getElementById('menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    const sidebarOverlay = document.querySelector('.sidebar-overlay');
    const mainContent = document.querySelector('.main-content');
    
    console.log('Menu toggle elements found:', {
      'menu-toggle': !!menuToggle,
      'sidebar': !!sidebar,
      'sidebar-overlay': !!sidebarOverlay
    });
    
    function toggleSidebar() {
      console.log('Toggling sidebar');
      sidebar.classList.toggle('open');
      sidebarOverlay.classList.toggle('show');
      document.body.classList.toggle('sidebar-open');
    }
    
    function closeSidebar() {
      console.log('Closing sidebar');
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('show');
      document.body.classList.remove('sidebar-open');
    }
    
    // Check if we're on mobile view
    function isMobileView() {
      return window.innerWidth < 768;
    }
    
    // Handle window resize
    function handleResize() {
      if (!isMobileView() && sidebar.classList.contains('open')) {
        // If we switched to desktop view and sidebar was open in mobile view
        closeSidebar();
      }
    }
    
    // Add resize event listener
    window.addEventListener('resize', handleResize);
    
    // Add event listener to menu toggle button
    if (menuToggle) {
      menuToggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        toggleSidebar();
      });
    }
    
    // Close sidebar when clicking the overlay
    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', closeSidebar);
    }
    
    // Close sidebar when clicking on main content in mobile view
    if (mainContent) {
      mainContent.addEventListener('click', (e) => {
        if (sidebar.classList.contains('open') && isMobileView()) {
          closeSidebar();
        }
      });
    }
    
    // Close sidebar when escape key is pressed
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && sidebar.classList.contains('open')) {
        closeSidebar();
      }
    });

    // SETTINGS BUTTON - Try multiple selector approaches
    const settingsIcon = document.getElementById('settings-icon');
    const settingsButton = document.querySelector('.settings-button');
    const settingsLink = document.querySelector('#settings-icon, .settings-button, [data-lucide="settings"]');
    
    console.log('Settings selectors found:', {
      'settings-icon': !!settingsIcon,
      'settings-button': !!settingsButton,
      'settings-link': !!settingsLink
    });
    
    // Add event listeners for all navigation elements in sidebar
    function setupNavigationLinks() {
      console.log('Setting up navigation links');
      
      // Channel links
      const channelLinks = document.querySelectorAll('.channel');
      channelLinks.forEach(link => {
        // Remove any existing event listeners
        const newLink = link.cloneNode(true);
        link.parentNode.replaceChild(newLink, link);
        
        newLink.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          const channelText = newLink.querySelector('span').textContent.trim();
          console.log('Channel clicked:', channelText);
          
          if (channelText === 'General') {
            handleNavigation('/chat', e);
          } else if (channelText === 'Social Feed') {
            console.log('Navigating to Social Feed');
            handleNavigation('/social-feed', e);
          }
          
          // Close sidebar in mobile view
          if (window.innerWidth < 768) {
            closeSidebar();
          }
        });
      });
      
      // User profile link
      const userProfile = document.querySelector('.user-profile');
      if (userProfile) {
        // Remove any existing event listeners
        const newUserProfile = userProfile.cloneNode(true);
        userProfile.parentNode.replaceChild(newUserProfile, userProfile);
        
        newUserProfile.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('User profile clicked');
          handleNavigation('/profile', e);
        });
      }
      
      // Settings button
      if (settingsButton) {
        // Remove any existing event listeners
        const newSettingsButton = settingsButton.cloneNode(true);
        settingsButton.parentNode.replaceChild(newSettingsButton, settingsButton);
        
        newSettingsButton.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Settings button clicked');
          handleNavigation('/settings', e);
        });
      }
      
      // Leave button
      const leaveButton = document.querySelector('.leave-button');
      if (leaveButton) {
        // Remove any existing event listeners
        const newLeaveButton = leaveButton.cloneNode(true);
        leaveButton.parentNode.replaceChild(newLeaveButton, leaveButton);
        
        newLeaveButton.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('Leave button clicked');
          handleNavigation('/logout', e);
        });
      }
    }
    
    // Call setupNavigationLinks after DOM is loaded
    setupNavigationLinks();
    
    // Also call it after a short delay in case DOM elements are modified by other scripts
    setTimeout(setupNavigationLinks, 500);
    
    // Add click handler to all possible settings elements
    if (settingsIcon) {
      settingsIcon.addEventListener('click', (e) => {
        console.log('Settings icon clicked');
        handleNavigation('/settings', e);
      });
    }
    
    if (settingsButton) {
      settingsButton.addEventListener('click', (e) => {
        console.log('Settings button clicked');
        handleNavigation('/settings', e);
      });
    }
    
    // Add direct onclick to settings button
    const allSettingsButtons = document.querySelectorAll('#settings-icon, .settings-button, [data-lucide="settings"]');
    allSettingsButtons.forEach(btn => {
      btn.onclick = function(e) {
        console.log('Settings element clicked via onclick');
        handleNavigation('/settings', e);
      };
    });

    // LEAVE BUTTON - Try multiple selector approaches
    const leaveButton = document.getElementById('leave-button');
    const leaveButtonClass = document.querySelector('.leave-button');
    const leaveButtonByText = Array.from(document.querySelectorAll('button')).find(el => el.textContent.includes('Leave'));
    
    console.log('Leave button selectors found:', {
      'leave-button': !!leaveButton,
      'leave-button-class': !!leaveButtonClass,
      'leave-button-by-text': !!leaveButtonByText
    });
    
    // Add click handler to all possible leave elements
    if (leaveButton) {
      leaveButton.addEventListener('click', (e) => {
        console.log('Leave button clicked');
        handleNavigation('/logout', e);
      });
    }
    
    if (leaveButtonClass) {
      leaveButtonClass.addEventListener('click', (e) => {
        console.log('Leave button (class) clicked');
        handleNavigation('/logout', e);
      });
    }
    
    if (leaveButtonByText) {
      leaveButtonByText.addEventListener('click', (e) => {
        console.log('Leave button (text) clicked');
        handleNavigation('/logout', e);
      });
    }
    
    // Add direct onclick to leave chat elements
    document.querySelectorAll('#leave-button, .leave-button, [data-lucide="log-out"]').forEach(btn => {
      btn.onclick = function(e) {
        console.log('Leave element clicked via onclick');
        handleNavigation('/logout', e);
      };
    });
    
    // Force inline onclick attributes for critical buttons
    setTimeout(() => {
      // Find buttons by their text content or icon
      document.querySelectorAll('button, a, div').forEach(el => {
        if (el.textContent.includes('Settings') || 
            el.querySelector('[data-lucide="settings"]') || 
            el.id === 'settings-icon' || 
            el.classList.contains('settings-button')) {
          el.setAttribute('onclick', "handleNavigation('/settings', event)");
        }
        
        if (el.textContent.includes('Leave') || 
            el.querySelector('[data-lucide="log-out"]') || 
            el.id === 'leave-button' || 
            el.classList.contains('leave-button')) {
          el.setAttribute('onclick', "handleNavigation('/logout', event)");
        }
      });
    }, 500);
    
    // ... rest of your existing code ...
  });
  </script>
  </body>
  </html>