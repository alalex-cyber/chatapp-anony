<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings | Campus Connect</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.244.0/lucide.min.js"></script>
  <style>
    /* Base styles */
    :root {
      /* Colors - Dark Theme */
      --bg-primary: #1e293b;
      --bg-secondary: #0f172a;
      --bg-tertiary: #1e293b;
      --bg-highlight: rgba(59, 130, 246, 0.1);
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-color: #334155;
      --accent-blue: #3b82f6;
      --accent-purple: #a855f7;
      --accent-green: #22c55e;
      --accent-yellow: #eab308;
      --accent-pink: #ec4899;
      --accent-teal: #14b8a6;
      --accent-orange: #f97316;
      --accent-red: #ef4444;
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
      background-color: var(--bg-secondary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem;
    }

    /* Header */
    .settings-header {
      width: 100%;
      max-width: 800px;
        display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .settings-title {
      font-size: 2rem;
      font-weight: 700;
    }

    .settings-subtitle {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-top: 0.25rem;
    }

    .back-button {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 1rem;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .back-button:hover {
      background-color: rgba(59, 130, 246, 0.1);
    }

    .back-button svg {
      margin-right: 0.5rem;
    }

    /* Settings sections */
    .settings-container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .settings-card {
      background-color: var(--bg-primary);
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
    }

    .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .section-icon {
      width: 2rem;
      height: 2rem;
      border-radius: 0.5rem;
      background-color: rgba(59, 130, 246, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 0.75rem;
    }

    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Settings rows */
    .settings-row {
      margin-bottom: 1.5rem;
    }

    .settings-row:last-child {
      margin-bottom: 0;
    }

    .settings-label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      display: block;
    }

    .settings-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    /* Avatar section */
    .avatar-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  position: relative;
}


    @media (max-width: 768px) {
      .avatar-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    @media (max-width: 480px) {
      .avatar-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .avatar-option {
  position: relative;
  aspect-ratio: 1;
  border-radius: 0.5rem;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all 0.2s;
  overflow: hidden;
  background-color: var(--bg-tertiary);
  /* Ensure the avatar is clickable with proper z-index */
  z-index: 1;
  user-select: none;
  -webkit-user-select: none;
}

    .avatar-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .avatar-option.selected {
      border-color: var(--accent-blue);
      position: relative;
    }

    .avatar-option.selected::after {
      content: '';
      position: absolute;
      top: -8px;
      right: -8px;
      width: 1.5rem;
      height: 1.5rem;
      background-color: var(--accent-blue);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 0 2px var(--bg-primary);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      background-size: 12px;
    }

    .avatar-option img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 0.5rem;
  pointer-events: none; /* This ensures clicks go to the parent div */
}

    /* Color selection */
    .color-options {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .color-option {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: var(--text-primary);
      transform: scale(1.1);
      box-shadow: 0 0 0 2px var(--bg-primary);
    }

    /* Form controls */
    .select-wrapper {
      position: relative;
      width: 100%;
      max-width: 15rem;
    }

    .select-control {
      width: 100%;
      padding: 0.625rem 1rem;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      font-size: 0.875rem;
      appearance: none;
      cursor: pointer;
    }

    .select-wrapper::after {
      content: '';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 0.75rem;
      height: 0.75rem;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      pointer-events: none;
    }

    /* Toggle switch */
    .toggle-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .toggle {
      position: relative;
      display: inline-block;
      width: 3.25rem;
      height: 1.75rem;
      flex-shrink: 0;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border-color);
      border-radius: 1.75rem;
      transition: 0.3s;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 1.25rem;
      width: 1.25rem;
      left: 0.25rem;
      bottom: 0.25rem;
      background-color: white;
      border-radius: 50%;
      transition: 0.3s;
    }

    input:checked + .toggle-slider {
      background-color: var(--accent-blue);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(1.5rem);
    }

    /* Action buttons */
    .action-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .button {
      padding: 0.625rem 1.25rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .button-secondary {
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .button-secondary:hover {
      background-color: var(--border-color);
    }

    .button-primary {
      background-color: var(--accent-blue);
      color: white;
    }

    .button-primary:hover {
      background-color: #2563eb;
    }

    /* Colors */
    .bg-blue { background-color: var(--accent-blue); }
    .bg-purple { background-color: var(--accent-purple); }
    .bg-green { background-color: var(--accent-green); }
    .bg-yellow { background-color: var(--accent-yellow); }
    .bg-pink { background-color: var(--accent-pink); }
    .bg-teal { background-color: var(--accent-teal); }
    .bg-orange { background-color: var(--accent-orange); }
    .bg-red { background-color: var(--accent-red); }

    /* Toast notifications */
    .settings-toast {
      position: fixed;
      bottom: 1.5rem;
      right: 1.5rem;
      background-color: var(--accent-blue);
      color: white;
      padding: 0.75rem 1.25rem;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 100;
      transform: translateY(100%);
      opacity: 0;
      transition: all 0.3s ease;
    }

    .settings-toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    .toast-icon {
      display: flex;
    }

    /* Multi-row layout for settings with buttons */
    .multi-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Danger button */
    .button-danger {
      background-color: var(--accent-red);
      color: white;
    }

    .button-danger:hover {
      background-color: #dc2626;
    }

    /* Light mode */
    body.light-mode {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --bg-highlight: rgba(59, 130, 246, 0.05);
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #94a3b8;
      --border-color: #e2e8f0;
    }

    .avatar-pagination {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .avatar-page {
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      background-color: var(--bg-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .avatar-page:hover {
      background-color: var(--border-color);
    }

    .avatar-page.active {
      background-color: var(--accent-blue);
      color: white;
    }

    .avatar-search {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .avatar-search-input {
      flex: 1;
      padding: 0.625rem 1rem;
      background-color: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      font-size: 0.875rem;
    }

    .avatar-search-input:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    /* Avatar category tabs */
    .avatar-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .avatar-category {
      padding: 0.5rem 1rem;
  border-radius: 9999px;
  background-color: var(--bg-tertiary);
  color: var(--text-secondary);
      font-size: 0.875rem;
      cursor: pointer;
  transition: all 0.2s;
  position: relative;
  z-index: 2;
  user-select: none;
  -webkit-user-select: none;
}

    .avatar-category:hover {
      background-color: var(--border-color);
    }

    .avatar-category.active {
      background-color: var(--accent-blue);
      color: white;
    }

    /* Modal styles for password change */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: var(--bg-primary);
      border-radius: 0.75rem;
      padding: 1.5rem;
      width: 100%;
      max-width: 500px;
      box-shadow: var(--card-shadow);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      transition: color 0.2s;
    }

    .modal-close:hover {
      color: var(--text-primary);
    }

    .modal-body {
      margin-bottom: 1.5rem;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 1rem;
    }
  </style>
</head>
<body id="body">
  <div class="settings-header">
          <div>
      <h1 class="settings-title">Settings</h1>
      <p class="settings-subtitle">Customize your anonymous experience</p>
          </div>
    <button class="back-button" id="back-to-chat" onclick="window.location.href='/chat';">
      <i data-lucide="arrow-left"></i>
            Back to Chat
          </button>
      </div>

      <div class="settings-container">
          <!-- Appearance Section -->
    <div class="settings-card">
      <div class="section-header">
        <div class="section-icon">
          <i data-lucide="palette"></i>
              </div>
        <h2 class="section-title">Appearance</h2>
            </div>

      <!-- Avatar Selection -->
            <div class="settings-row">
        <label class="settings-label">Avatar</label>
        <p class="settings-description">Choose your anonymous profile picture</p>
        
        <div class="avatar-categories">
          <div class="avatar-category active" data-category="all">All</div>
          <div class="avatar-category" data-category="animals">Animals</div>
          <div class="avatar-category" data-category="people">People</div>
          <div class="avatar-category" data-category="characters">Characters</div>
          <div class="avatar-category" data-category="objects">Objects</div>
              </div>
        
        <div class="avatar-search">
          <input type="text" class="avatar-search-input" placeholder="Search avatars..." id="avatar-search">
                    </div>
        
        <div class="avatar-grid" id="avatar-grid">
          <!-- First row - People -->
          <div class="avatar-option selected" data-avatar="avatar-1" data-category="people">
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Felix" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-2" data-category="people">
            <img src="https://api.dicebear.com/7.x/lorelei/svg?seed=Jasper" alt="Avatar option">
                    </div>
          <div class="avatar-option" data-avatar="avatar-3" data-category="people">
            <img src="https://api.dicebear.com/7.x/micah/svg?seed=Aneka" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-4" data-category="people">
            <img src="https://api.dicebear.com/7.x/fun-emoji/svg?seed=Dusty" alt="Avatar option">
                    </div>
          <div class="avatar-option" data-avatar="avatar-5" data-category="animals">
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Koda" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-6" data-category="characters">
            <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Harper" alt="Avatar option">
                    </div>
          
          <!-- Second row - Animals and characters -->
          <div class="avatar-option" data-avatar="avatar-7" data-category="animals">
            <img src="https://api.dicebear.com/7.x/thumbs/svg?seed=Felix" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-8" data-category="animals">
            <img src="https://api.dicebear.com/7.x/croodles/svg?seed=Indie" alt="Avatar option">
                    </div>
          <div class="avatar-option" data-avatar="avatar-9" data-category="characters">
            <img src="https://api.dicebear.com/7.x/micah/svg?seed=Jasper" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-10" data-category="objects">
            <img src="https://api.dicebear.com/7.x/open-peeps/svg?seed=Lucy" alt="Avatar option">
                    </div>
          <div class="avatar-option" data-avatar="avatar-11" data-category="characters">
            <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Max" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-12" data-category="people">
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Garfield" alt="Avatar option">
                    </div>
          
          <!-- Third row - Mix -->
          <div class="avatar-option" data-avatar="avatar-13" data-category="characters">
            <img src="https://api.dicebear.com/7.x/thumbs/svg?seed=Bailey" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-14" data-category="animals">
            <img src="https://api.dicebear.com/7.x/croodles/svg?seed=Cali" alt="Avatar option">
                    </div>
          <div class="avatar-option" data-avatar="avatar-15" data-category="people">
            <img src="https://api.dicebear.com/7.x/fun-emoji/svg?seed=Indie" alt="Avatar option">
                  </div>
          <div class="avatar-option" data-avatar="avatar-16" data-category="objects">
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Luna" alt="Avatar option">
                </div>
          <div class="avatar-option" data-avatar="avatar-17" data-category="characters">
            <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Nova" alt="Avatar option">
          </div>
          <div class="avatar-option" data-avatar="avatar-18" data-category="people">
            <img src="https://api.dicebear.com/7.x/lorelei/svg?seed=Oscar" alt="Avatar option">
              </div>
            </div>

        <div class="avatar-pagination">
          <div class="avatar-page active">1</div>
          <div class="avatar-page">2</div>
          <div class="avatar-page">3</div>
          <div class="avatar-page">4</div>
        </div>
      </div>

      <!-- Color Selection -->
            <div class="settings-row">
        <label class="settings-label">Avatar Background</label>
        <p class="settings-description">Choose a color for your avatar background</p>
        
        <div class="color-options">
          <div class="color-option bg-blue selected" data-color="blue"></div>
          <div class="color-option bg-purple" data-color="purple"></div>
          <div class="color-option bg-green" data-color="green"></div>
          <div class="color-option bg-yellow" data-color="yellow"></div>
          <div class="color-option bg-pink" data-color="pink"></div>
          <div class="color-option bg-teal" data-color="teal"></div>
          <div class="color-option bg-orange" data-color="orange"></div>
          <div class="color-option bg-red" data-color="red"></div>
              </div>
      </div>

      <!-- Theme Selection -->
      <div class="settings-row">
        <label class="settings-label">Theme</label>
        <p class="settings-description">Choose light or dark mode</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="theme-select">
                  <option value="dark">Dark Mode</option>
                  <option value="light">Light Mode</option>
                  <option value="system">System Default</option>
                </select>
              </div>
            </div>

      <!-- Chat Bubble Style -->
            <div class="settings-row">
        <label class="settings-label">Chat Bubble Style</label>
        <p class="settings-description">Choose your preferred message bubble style</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="bubble-style-select">
                  <option value="modern">Modern (Default)</option>
                  <option value="classic">Classic</option>
                  <option value="minimal">Minimal</option>
                </select>
              </div>
            </div>
          </div>

    <!-- Privacy & Security Section -->
    <div class="settings-card">
      <div class="section-header">
        <div class="section-icon">
          <i data-lucide="shield"></i>
              </div>
        <h2 class="section-title">Privacy & Security</h2>
            </div>

      <!-- Online Status -->
            <div class="settings-row">
        <label class="settings-label">Online Status</label>
        <p class="settings-description">Show when you're active in the chat</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="online-status-select">
                  <option value="online">Online</option>
                  <option value="invisible">Invisible</option>
            <option value="away">Away</option>
                </select>
              </div>
            </div>

      <!-- Direct Message Privacy -->
            <div class="settings-row">
        <label class="settings-label">Direct Message Privacy</label>
        <p class="settings-description">Control who can send you direct messages</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="dm-privacy-select">
                  <option value="everyone">Everyone</option>
            <option value="friends">Friends Only</option>
                  <option value="nobody">Nobody</option>
                </select>
              </div>
            </div>

      <!-- Read Receipts -->
            <div class="settings-row">
        <div class="toggle-row">
              <div>
            <label class="settings-label">Read Receipts</label>
            <p class="settings-description">Let others know when you've read their messages</p>
              </div>
          <label class="toggle">
            <input type="checkbox" id="read-receipts-toggle">
            <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

      <!-- Typing Indicators -->
            <div class="settings-row">
        <div class="toggle-row">
              <div>
            <label class="settings-label">Typing Indicators</label>
            <p class="settings-description">Show when you're typing a message</p>
              </div>
          <label class="toggle">
            <input type="checkbox" id="typing-indicators-toggle" checked>
            <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

      <!-- Message Retention -->
            <div class="settings-row">
        <label class="settings-label">Message Retention</label>
        <p class="settings-description">How long to keep your chat history</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="message-retention-select">
                  <option value="forever">Forever</option>
            <option value="1-year">1 Year</option>
            <option value="6-months">6 Months</option>
            <option value="30-days">30 Days</option>
            <option value="7-days">7 Days</option>
                </select>
              </div>
            </div>

      <!-- Clear Chat History -->
            <div class="settings-row">
        <div class="multi-row">
              <div>
            <label class="settings-label">Clear Chat History</label>
            <p class="settings-description">Delete all your messages and chat history</p>
              </div>
          <button class="button button-danger" id="clear-history-button">Clear History</button>
              </div>
            </div>
          </div>

          <!-- Notifications Section -->
    <div class="settings-card">
      <div class="section-header">
        <div class="section-icon">
          <i data-lucide="bell"></i>
              </div>
        <h2 class="section-title">Notifications</h2>
            </div>

      <!-- Enable Notifications -->
            <div class="settings-row">
        <div class="toggle-row">
              <div>
            <label class="settings-label">Enable Notifications</label>
            <p class="settings-description">Receive alerts for new messages and mentions</p>
              </div>
          <label class="toggle">
            <input type="checkbox" id="notifications-toggle" checked>
            <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

      <!-- Sound Alerts -->
            <div class="settings-row">
        <div class="toggle-row">
              <div>
            <label class="settings-label">Sound Alerts</label>
            <p class="settings-description">Play sounds for new messages</p>
              </div>
          <label class="toggle">
            <input type="checkbox" id="sound-alerts-toggle" checked>
            <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

      <!-- General Channel Notifications -->
            <div class="settings-row">
        <label class="settings-label">General Channel Notifications</label>
        <p class="settings-description">How to be notified about General channel</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="general-notifications-select">
                  <option value="all">All Messages</option>
            <option value="mentions">Mentions Only</option>
                  <option value="none">None</option>
                </select>
              </div>
            </div>

      <!-- Social Feed Notifications -->
            <div class="settings-row">
        <label class="settings-label">Social Feed Notifications</label>
        <p class="settings-description">How to be notified about Social Feed</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="social-notifications-select">
                  <option value="all">All Messages</option>
            <option value="mentions">Mentions Only</option>
                  <option value="none">None</option>
                </select>
              </div>
            </div>

      <!-- Direct Message Notifications -->
            <div class="settings-row">
        <label class="settings-label">Direct Message Notifications</label>
        <p class="settings-description">How to be notified about DMs</p>
        
        <div class="select-wrapper">
          <select class="select-control" id="dm-notifications-select">
                  <option value="all">All Messages</option>
                  <option value="none">None</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Account Section -->
    <div class="settings-card">
      <div class="section-header">
        <div class="section-icon">
          <i data-lucide="user"></i>
              </div>
        <h2 class="section-title">Account</h2>
            </div>

      <!-- Change Password -->
            <div class="settings-row">
        <div class="multi-row">
              <div>
            <label class="settings-label">Change Password</label>
            <p class="settings-description">Update your login credentials</p>
              </div>
          <button class="button button-secondary" id="change-password-button">Change Password</button>
              </div>
            </div>

      <!-- Two-Factor Authentication -->
            <div class="settings-row">
        <div class="toggle-row">
              <div>
            <label class="settings-label">Two-Factor Authentication</label>
            <p class="settings-description">Add an extra layer of security</p>
              </div>
          <label class="toggle">
            <input type="checkbox" id="two-factor-toggle">
            <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

      <!-- Active Sessions -->
            <div class="settings-row">
        <div class="multi-row">
              <div>
            <label class="settings-label">Active Sessions</label>
            <p class="settings-description">Manage devices where you're logged in</p>
              </div>
          <button class="button button-secondary" id="view-sessions-button">View Sessions</button>
              </div>
            </div>

      <!-- Reset Identity -->
            <div class="settings-row">
        <div class="multi-row">
              <div>
            <label class="settings-label">Reset Identity</label>
            <p class="settings-description">Generate a new anonymous identity (cannot be undone)</p>
              </div>
          <button class="button button-secondary" id="reset-identity-button">Reset Identity</button>
              </div>
            </div>

      <!-- Delete Account -->
            <div class="settings-row">
        <div class="multi-row">
              <div>
            <label class="settings-label">Delete Account</label>
            <p class="settings-description">Permanently delete your account and all data</p>
              </div>
          <button class="button button-danger" id="delete-account-button">Delete Account</button>
              </div>
            </div>
          </div>

    <!-- Action buttons at bottom of page -->
    <div class="action-buttons">
      <button class="button button-secondary" id="cancel-button">Cancel</button>
      <button class="button button-primary" id="save-button">Save Changes</button>
          </div>
        </div>

  <!-- Change Password Modal -->
  <div class="modal-overlay" id="password-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Change Password</h3>
        <button class="modal-close" id="password-modal-close">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-row">
          <label class="settings-label">Current Password</label>
          <input type="password" class="avatar-search-input" id="current-password">
    </div>
        <div class="settings-row">
          <label class="settings-label">New Password</label>
          <input type="password" class="avatar-search-input" id="new-password">
        </div>
        <div class="settings-row">
          <label class="settings-label">Confirm New Password</label>
          <input type="password" class="avatar-search-input" id="confirm-password">
        </div>
      </div>
      <div class="modal-footer">
        <button class="button button-secondary" id="password-cancel">Cancel</button>
        <button class="button button-primary" id="password-save">Update Password</button>
      </div>
    </div>
  </div>

  <!-- Active Sessions Modal -->
  <div class="modal-overlay" id="sessions-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Active Sessions</h3>
        <button class="modal-close" id="sessions-modal-close">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-row">
          <div class="multi-row">
            <div>
              <label class="settings-label">Current Device</label>
              <p class="settings-description">Windows 11 • Chrome • San Francisco, CA</p>
            </div>
            <div class="badge" style="background-color: var(--accent-green); color: white;">Current</div>
          </div>
        </div>
        <div class="settings-row">
          <div class="multi-row">
            <div>
              <label class="settings-label">iPhone 14 Pro</label>
              <p class="settings-description">iOS 17 • Safari • San Francisco, CA</p>
              <p class="settings-description" style="color: var(--text-muted);">Last active: Today at 10:45 AM</p>
            </div>
            <button class="button button-danger">Log Out</button>
          </div>
        </div>
        <div class="settings-row">
          <div class="multi-row">
            <div>
              <label class="settings-label">MacBook Pro</label>
              <p class="settings-description">macOS 14 • Safari • Berkeley, CA</p>
              <p class="settings-description" style="color: var(--text-muted);">Last active: Yesterday at 5:30 PM</p>
            </div>
            <button class="button button-danger">Log Out</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="button button-secondary" id="sessions-close">Close</button>
        <button class="button button-danger" id="logout-all">Log Out All Devices</button>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="settings-toast" id="settings-toast">
    <div class="toast-icon">
      <i data-lucide="check-circle"></i>
    </div>
    <span id="toast-message">Settings saved successfully!</span>
  </div>

  <script>
    // Replace the JavaScript portion of your code with this fixed version

document.addEventListener('DOMContentLoaded', function() {
  try {
    // Initialize Lucide icons
    lucide.createIcons();
    
    // Settings variables
    let selectedAvatar = localStorage.getItem('selectedAvatar') || 'avatar-1';
    let selectedColor = localStorage.getItem('selectedColor') || 'blue';
    let selectedTheme = localStorage.getItem('theme') || 'dark';
    
    console.log('Initial settings:', { selectedAvatar, selectedColor, selectedTheme });
    
    // DOM Elements
    const body = document.getElementById('body');
    const avatarOptions = document.querySelectorAll('.avatar-option');
    const colorOptions = document.querySelectorAll('.color-option');
    const themeSelect = document.getElementById('theme-select');
    const saveButton = document.getElementById('save-button');
    const cancelButton = document.getElementById('cancel-button');
    const backButton = document.getElementById('back-to-chat');
    const avatarSearch = document.getElementById('avatar-search');
    const avatarCategories = document.querySelectorAll('.avatar-category');
    const avatarPages = document.querySelectorAll('.avatar-page');
    const avatarGrid = document.getElementById('avatar-grid');
    const changePasswordButton = document.getElementById('change-password-button');
    const viewSessionsButton = document.getElementById('view-sessions-button');
    const clearHistoryButton = document.getElementById('clear-history-button');
    const resetIdentityButton = document.getElementById('reset-identity-button');
    const deleteAccountButton = document.getElementById('delete-account-button');
    const settingsToast = document.getElementById('settings-toast');
    const toastMessage = document.getElementById('toast-message');
    
    // Modal elements
    const passwordModal = document.getElementById('password-modal');
    const passwordModalClose = document.getElementById('password-modal-close');
    const passwordCancel = document.getElementById('password-cancel');
    const passwordSave = document.getElementById('password-save');
    const sessionsModal = document.getElementById('sessions-modal');
    const sessionsModalClose = document.getElementById('sessions-modal-close');
    const sessionsClose = document.getElementById('sessions-close');
    const logoutAllButton = document.getElementById('logout-all');
    
    // FIX 1: Ensure all avatar options are visible initially and have proper display property
    avatarOptions.forEach(option => {
      option.style.display = 'block';
    });
    
    // Set initial theme and avatar selection
    themeSelect.value = selectedTheme;
    if (selectedTheme === 'light') {
      body.classList.add('light-mode');
    }
    
    // Initialize avatar selection
    updateAvatarSelection();
    updateColorSelection();
    
    // FIX 2: Handle avatar selection - completely rewritten event handler
    avatarOptions.forEach(option => {
      option.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('Avatar clicked:', this.getAttribute('data-avatar'));
        
        selectedAvatar = this.getAttribute('data-avatar');
        updateAvatarSelection();
        showToast(`Avatar ${selectedAvatar} selected`);
      };
    });
    
    // FIX 3: Handle color selection - simplified and more robust
    colorOptions.forEach(option => {
      option.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        selectedColor = this.getAttribute('data-color');
        updateColorSelection();
        showToast(`Color ${selectedColor} selected`);
      };
    });
    
    // Handle theme selection
    themeSelect.addEventListener('change', function() {
      selectedTheme = this.value;
      if (selectedTheme === 'light') {
        body.classList.add('light-mode');
      } else {
        body.classList.remove('light-mode');
      }
    });
    
    // FIX 4: Improve avatar selection update function
    function updateAvatarSelection() {
      console.log('Updating avatar selection to:', selectedAvatar);
      
      // First remove selected class from all options
      avatarOptions.forEach(option => {
        option.classList.remove('selected');
      });
      
      // Then find and add selected class to the chosen avatar
      const selectedOption = document.querySelector(`.avatar-option[data-avatar="${selectedAvatar}"]`);
      if (selectedOption) {
        selectedOption.classList.add('selected');
      } else {
        console.warn(`Avatar with data-avatar="${selectedAvatar}" not found`);
      }
    }
    
    // Update UI for color selection
    function updateColorSelection() {
      // First remove selected class from all options
      colorOptions.forEach(option => {
        option.classList.remove('selected');
      });
      
      // Then find and add selected class to the chosen color
      const selectedOption = document.querySelector(`.color-option[data-color="${selectedColor}"]`);
      if (selectedOption) {
        selectedOption.classList.add('selected');
      } else {
        console.warn(`Color with data-color="${selectedColor}" not found`);
      }
    }
    
    // FIX 5: Improved avatar search with better display property handling
    avatarSearch.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      const selectedCategory = document.querySelector('.avatar-category.active').getAttribute('data-category');
      let visibleAvatars = 0;
      
      avatarOptions.forEach(option => {
        const category = option.getAttribute('data-category');
        const avatar = option.getAttribute('data-avatar');
        
        // Only search within the currently selected category
        const categoryMatch = selectedCategory === 'all' || category === selectedCategory;
        const searchMatch = !searchTerm || 
                            avatar.toLowerCase().includes(searchTerm) || 
                            category.toLowerCase().includes(searchTerm);
        
        if (categoryMatch && searchMatch) {
          option.style.display = 'block';
          visibleAvatars++;
        } else {
          option.style.display = 'none';
        }
      });
      
      if (visibleAvatars === 0 && searchTerm) {
        showToast(`No avatars found matching "${searchTerm}"`);
      }
    });
    
    // FIX 6: Improved category filtering
    avatarCategories.forEach(category => {
      category.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        // Update active class
        avatarCategories.forEach(cat => cat.classList.remove('active'));
        this.classList.add('active');
        
        const selectedCategory = this.getAttribute('data-category');
        console.log('Selected category:', selectedCategory);
        
        // Clear search field when changing categories
        avatarSearch.value = '';
        
        // Filter avatars
        let visibleAvatars = 0;

    avatarOptions.forEach(option => {
          const avatarCategory = option.getAttribute('data-category');
          
          if (selectedCategory === 'all' || avatarCategory === selectedCategory) {
            option.style.display = 'block';
            visibleAvatars++;
          } else {
            option.style.display = 'none';
          }
        });
        
        // Select first page when changing categories
        avatarPages.forEach(p => p.classList.remove('active'));
        document.querySelector('.avatar-page:first-child').classList.add('active');
        
        if (visibleAvatars === 0) {
          showToast(`No avatars found in the ${selectedCategory} category`);
        }
      });
    });

    // Handle avatar pagination
    avatarPages.forEach(page => {
      page.addEventListener('click', function() {
        // Update active class
        avatarPages.forEach(p => p.classList.remove('active'));
        this.classList.add('active');
        
        // In a real app, this would load new avatars
        // For now, we'll just scroll to top of grid
        avatarGrid.scrollIntoView({ behavior: 'smooth' });
      });
    });

    // Change Password Modal
    changePasswordButton.addEventListener('click', function() {
      passwordModal.classList.add('active');
    });
    
    passwordModalClose.addEventListener('click', function() {
      passwordModal.classList.remove('active');
    });
    
    passwordCancel.addEventListener('click', function() {
      passwordModal.classList.remove('active');
    });
    
    passwordSave.addEventListener('click', function() {
      // Validation would happen here in real app
      passwordModal.classList.remove('active');
      showToast('Password updated successfully!');
    });
    
    // Sessions Modal
    viewSessionsButton.addEventListener('click', function() {
      sessionsModal.classList.add('active');
    });
    
    sessionsModalClose.addEventListener('click', function() {
      sessionsModal.classList.remove('active');
    });
    
    sessionsClose.addEventListener('click', function() {
      sessionsModal.classList.remove('active');
    });
    
    logoutAllButton.addEventListener('click', function() {
      // Logout logic would happen here
      sessionsModal.classList.remove('active');
      showToast('Logged out of all other devices');
    });
    
    // Confirmation dialogs for danger actions
    clearHistoryButton.addEventListener('click', function() {
      if (confirm('Are you sure you want to clear your chat history? This action cannot be undone.')) {
        showToast('Chat history cleared successfully');
      }
    });
    
    resetIdentityButton.addEventListener('click', function() {
      if (confirm('Are you sure you want to reset your identity? This will create a new anonymous profile and cannot be undone.')) {
        showToast('Identity reset successfully');
      }
    });
    
    deleteAccountButton.addEventListener('click', function() {
      if (confirm('Are you sure you want to delete your account? All your data will be permanently removed.')) {
        showToast('Account scheduled for deletion');
        setTimeout(() => {
          window.location.href = '/login';
        }, 2000);
      }
    });
    
    // Save button click handler
    saveButton.addEventListener('click', function() {
      // Extract the DiceBear avatar style from the selected avatar's image URL
      const selectedAvatarOption = document.querySelector('.avatar-option.selected');
      let diceBearStyle = 'bottts'; // Default style
      let diceBearSeed = 'Felix'; // Default seed
      
      if (selectedAvatarOption) {
        const imgElement = selectedAvatarOption.querySelector('img');
        if (imgElement && imgElement.src) {
          // Parse the DiceBear URL to extract style and seed
          // Example URL: https://api.dicebear.com/7.x/bottts/svg?seed=Felix
          const url = new URL(imgElement.src);
          const pathParts = url.pathname.split('/');
          if (pathParts.length >= 4) {
            diceBearStyle = pathParts[3]; // This will be "bottts", "lorelei", etc.
          }
          const seedParam = url.searchParams.get('seed');
          if (seedParam) {
            diceBearSeed = seedParam;
          }
        }
      }
      
      // Save settings to localStorage
      localStorage.setItem('selectedAvatar', selectedAvatar);
      localStorage.setItem('selectedColor', selectedColor);
      localStorage.setItem('theme', selectedTheme);
      localStorage.setItem('selectedGravatar', diceBearStyle); // Store DiceBear style as Gravatar style
      localStorage.setItem('selectedSeed', diceBearSeed); // Store the seed value
      
      console.log('Saved settings:', {
        avatar: selectedAvatar,
        color: selectedColor,
        theme: selectedTheme,
        gravatarStyle: diceBearStyle,
        seed: diceBearSeed
      });
      
      // Show success message
      showToast('Settings saved successfully!');
      
      // Redirect after short delay
      setTimeout(() => {
      window.location.href = '/chat';
      }, 1500);
    });
    
    // Cancel button handler
    cancelButton.addEventListener('click', function() {
      window.location.href = '/chat';
    });
    
    // Back to chat button handler
    backButton.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('Back to chat button clicked');
      
      // Show a toast to inform the user
      showToast('Returning to chat...');
      
      // Redirect to chat page after a short delay
      setTimeout(() => {
        try {
          window.location.href = '/chat';
        } catch (error) {
          console.error('Navigation error:', error);
          // Alternative approach if the above fails
          window.location.replace('/chat');
        }
      }, 300);
    });
    
    // Function to show toast notification
    function showToast(message) {
      toastMessage.textContent = message;
      settingsToast.classList.add('show');
      
      setTimeout(() => {
        settingsToast.classList.remove('show');
      }, 3000);
    }
    
    // Close modals when clicking outside
    window.addEventListener('click', function(event) {
      if (event.target === passwordModal) {
        passwordModal.classList.remove('active');
      }
      if (event.target === sessionsModal) {
        sessionsModal.classList.remove('active');
      }
    });
    
    // FIX 7: Add a debug console log to check if everything loaded
    console.log('Settings page initialized successfully!');
    
  } catch (error) {
    console.error('Error initializing settings page:', error);
  }
    });
  </script>
</body>
</html>